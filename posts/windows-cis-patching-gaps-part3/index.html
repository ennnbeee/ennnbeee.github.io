<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" /><title>Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows 11 - odds&#43;endpoints</title><meta name="Description" content="Updating the Center for Internet Security (CIS) benchmark build kit for Windows 11 in Microsoft Intune for level 1 security settings."><meta property="og:url" content="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/">
  <meta property="og:site_name" content="odds&#43;endpoints">
  <meta property="og:title" content="Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows 11">
  <meta property="og:description" content="Updating the Center for Internet Security (CIS) benchmark build kit for Windows 11 in Microsoft Intune for level 1 security settings.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-07-15T11:26:37+01:00">
    <meta property="article:modified_time" content="2024-07-15T11:26:37+01:00">
    <meta property="article:tag" content="Intune">
    <meta property="article:tag" content="Security">
    <meta property="article:tag" content="Center for Internet Security (CIS)">
    <meta property="article:tag" content="Endpoint Security">
    <meta property="article:tag" content="Remediation Scripts">
    <meta property="article:tag" content="PowerShell">
    <meta property="og:image" content="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/featured.png">
      <meta property="og:see_also" content="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part1/">
      <meta property="og:see_also" content="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part2/">
      <meta property="og:see_also" content="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part4/">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/featured.png">
  <meta name="twitter:title" content="Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows 11">
  <meta name="twitter:description" content="Updating the Center for Internet Security (CIS) benchmark build kit for Windows 11 in Microsoft Intune for level 1 security settings.">
<meta name="application-name" content="odds&#43;endpoints">
<meta name="apple-mobile-web-app-title" content="odds&#43;endpoints">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#ffffff"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#ea580c">

<link rel="canonical" href="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/" /><link rel="prev" href="https://www.oddsandendpoints.co.uk/posts/windows-autopilot-v2-renaming/" /><link rel="next" href="https://www.oddsandendpoints.co.uk/posts/firewall-rule-policy-conversion/" />
<link rel="stylesheet" href="/css/main.min.css"><link rel="stylesheet" href="/css/style.min.css"><script type="application/ld+json">{"@context": "https://schema.org","@type": "BlogPosting",
        "headline": "Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows 11",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/"
        },"image": [{
                            "@type": "ImageObject",
                            "url": "https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/featured.png",
                            "width":  1000 ,
                            "height":  500 
                        }],"genre": "posts","keywords":["CIS Windows 11 benchmark","CIS Level 1 security settings","Windows 11 security","Intune security policies","CIS compliance"],"wordcount":  4334 ,
        "url": "https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/","datePublished": "2024-07-15T11:26:37+01:00","dateModified": "2024-07-15T11:26:37+01:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Nick Benton","logo": {
                    "@type": "ImageObject",
                    "url": "https://www.oddsandendpoints.co.uk/img/logo-aad-sqa.png",
                    "width":  240 ,
                    "height":  240 
                }},"author": [{
                        "@type": "Person",
                        "name": "Nick Benton",
                        "url": "https://www.linkedin.com/in/ennnbeee/"
                    }],"description": "Updating the Center for Internet Security (CIS) benchmark build kit for Windows 11 in Microsoft Intune for level 1 security settings."
    }</script></head>


<body data-instant-intensity="viewport"><script type="text/javascript">
    function setTheme(theme) {
      document.body.setAttribute('theme', theme); 
      document.documentElement.className = theme;
      document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark');
      if (theme === 'light') {
        document.documentElement.classList.remove('tw-dark')
      } else {
        document.documentElement.classList.add('tw-dark')
      }
      window.theme = theme;   
      window.isDark = window.theme !== 'light' 
    }
    function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
    function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
    if (window.localStorage && localStorage.getItem('theme')) {
        let theme = localStorage.getItem('theme');
        if (theme === 'light' || theme === 'dark') {
        setTheme(theme);
        } else {
            if ((window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                setTheme('dark');
            } else {
                setTheme('light');
            }
        }
      } else { 
        if ('auto' === 'light' || 'auto' === 'dark') 
            setTheme('auto'), saveTheme('auto'); 
        else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');
    }
    let metaColors = {'light': '#f8f8f8','dark': '#161b22'}
    getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
    window.switchThemeEventSet = new Set()
</script><div id="back-to-top"></div>
    <div id="mask"></div><header class="desktop print:!tw-hidden" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="odds&#43;endpoints"><span class="tw-mr-1"><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="600.000000pt" height="600.000000pt" viewBox="0 0 600.000000 600.000000" preserveAspectRatio="xMidYMid meet"><g transform="translate(0.000000,600.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M2905 5971 c-45 -20 -91 -69 -112 -118 -10 -26 -13 -137 -13 -542 l0 -511 -27 -6 c-275 -60 -446 -146 -626 -314 -186 -174 -327 -439 -367 -690 -13 -88 -13 -1472 0 -1560 28 -178 119 -397 221 -533 198 -263 478 -431 805 -482 129 -21 375 -16 490 9 283 61 530 211 702 425 119 148 186 281 240 471 l27 95 3 740 c3 815 2 837 -58 1017 -102 305 -326 566 -605 706 -97 48 -208 88 -295 106 l-65 13 -3 378 -2 378 67 -6 c102 -10 304 -51 428 -87 653 -190 1224 -660 1544 -1271 400 -763 387 -1675 -33 -2434 -329 -595 -933 -1062 -1585 -1225 -254 -64 -332 -73 -621 -74 -280 -1 -418 13 -640 66 -402 95 -818 288 -1075 498 -88 72 -237 223 -310 315 -185 231 -365 616 -455 968 -68 268 -90 440 -90 702 0 707 254 1312 762 1816 135 134 158 169 158 244 0 78 -30 132 -104 186 -33 25 -48 29 -103 29 -91 0 -127 -22 -273 -169 -350 -349 -576 -714 -730 -1179 -254 -768 -176 -1634 220 -2423 85 -168 210 -362 316 -491 89 -107 294 -305 399 -384 330 -250 812 -461 1275 -558 220 -46 535 -72 760 -62 1101 46 2076 694 2561 1701 195 405 289 826 289 1295 0 359 -61 699 -185 1037 -53 143 -192 421 -277 554 -507 789 -1331 1294 -2253 1379 -176 16 -313 13 -360 -9z m324 -1621 c264 -75 463 -269 552 -535 l24 -70 3 -710 c2 -623 1 -719 -13 -782 -63 -283 -270 -505 -550 -589 -81 -24 -106 -27 -250 -28 -122 0 -175 4 -224 17 -310 84 -533 325 -586 635 -14 78 -15 188 -13 764 l3 673 28 90 c41 131 97 224 197 325 116 117 224 180 365 213 104 24 118 26 260 22 94 -3 150 -9 204 -25z"/><path d="M2900 4023 c-36 -18 -65 -43 -85 -71 l-30 -44 -3 -211 c-2 -116 -1 -225 2 -243 9 -48 60 -117 105 -142 118 -66 260 -14 310 114 9 22 11 96 9 256 l-3 225 -28 41 c-64 98 -175 128 -277 75z"/></g></svg></span>odds&#43;endpoints</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item"
                    href="/posts/" > Posts </a><a class="menu-item"
                    href="/categories/" > Categories </a><a class="menu-item"
                    href="/tags/" > Tags </a><a class="menu-item"
                    href="https://github.com/ennnbeee/oddsandendpoints-scripts"  title="GitHub" 
                    rel="noopener noreferrer" target="_blank" ><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 496 512'><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d='M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z'/></svg>  </a><a class="menu-item"
                    href="/information/"  title="Information" ><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d='M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z'/></svg>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                    <input type="text"
                        placeholder="Search"
                        id="search-input-desktop">
                    <button class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
                    </button>
                    <button class="search-button search-clear" id="search-clear-desktop" title="Clear">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>
                    </button>
                    <span class="search-button search-loading tw-animate-spin" id="search-loading-desktop">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"/></svg>
                    </span>
                </span><button class="menu-item theme-switch" aria-label="Switch Theme">
                    <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
                </button></div>
        </div>
    </div>
</header><header class="mobile print:!tw-hidden" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="odds&#43;endpoints"><span class="tw-mr-1"><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="600.000000pt" height="600.000000pt" viewBox="0 0 600.000000 600.000000" preserveAspectRatio="xMidYMid meet"><g transform="translate(0.000000,600.000000) scale(0.100000,-0.100000)" fill="#000000" stroke="none"><path d="M2905 5971 c-45 -20 -91 -69 -112 -118 -10 -26 -13 -137 -13 -542 l0 -511 -27 -6 c-275 -60 -446 -146 -626 -314 -186 -174 -327 -439 -367 -690 -13 -88 -13 -1472 0 -1560 28 -178 119 -397 221 -533 198 -263 478 -431 805 -482 129 -21 375 -16 490 9 283 61 530 211 702 425 119 148 186 281 240 471 l27 95 3 740 c3 815 2 837 -58 1017 -102 305 -326 566 -605 706 -97 48 -208 88 -295 106 l-65 13 -3 378 -2 378 67 -6 c102 -10 304 -51 428 -87 653 -190 1224 -660 1544 -1271 400 -763 387 -1675 -33 -2434 -329 -595 -933 -1062 -1585 -1225 -254 -64 -332 -73 -621 -74 -280 -1 -418 13 -640 66 -402 95 -818 288 -1075 498 -88 72 -237 223 -310 315 -185 231 -365 616 -455 968 -68 268 -90 440 -90 702 0 707 254 1312 762 1816 135 134 158 169 158 244 0 78 -30 132 -104 186 -33 25 -48 29 -103 29 -91 0 -127 -22 -273 -169 -350 -349 -576 -714 -730 -1179 -254 -768 -176 -1634 220 -2423 85 -168 210 -362 316 -491 89 -107 294 -305 399 -384 330 -250 812 -461 1275 -558 220 -46 535 -72 760 -62 1101 46 2076 694 2561 1701 195 405 289 826 289 1295 0 359 -61 699 -185 1037 -53 143 -192 421 -277 554 -507 789 -1331 1294 -2253 1379 -176 16 -313 13 -360 -9z m324 -1621 c264 -75 463 -269 552 -535 l24 -70 3 -710 c2 -623 1 -719 -13 -782 -63 -283 -270 -505 -550 -589 -81 -24 -106 -27 -250 -28 -122 0 -175 4 -224 17 -310 84 -533 325 -586 635 -14 78 -15 188 -13 764 l3 673 28 90 c41 131 97 224 197 325 116 117 224 180 365 213 104 24 118 26 260 22 94 -3 150 -9 204 -25z"/><path d="M2900 4023 c-36 -18 -65 -43 -85 -71 l-30 -44 -3 -211 c-2 -116 -1 -225 2 -243 9 -48 60 -117 105 -142 118 -66 260 -14 310 114 9 22 11 96 9 256 l-3 225 -28 41 c-64 98 -175 128 -277 75z"/></g></svg></span>odds&#43;endpoints</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                <div class="search mobile" id="search-mobile">
                    <input type="text"
                        placeholder="Search"
                        id="search-input-mobile">
                    <button class="search-button search-toggle tw-h-10" id="search-toggle-mobile" title="Search">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
                    </button>
                    <button class="search-button search-clear tw-h-fit" id="search-clear-mobile" title="Clear">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"/></svg>
                    </button>
                    <span class="search-button search-loading tw-animate-spin" id="search-loading-mobile">
                        <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"/></svg>
                    </span>
                </div>
                <button class="search-cancel" id="search-cancel-mobile">
                    Cancel
                </button>
            </div><a class="menu-item" href="/posts/" title="" >Posts</a><a class="menu-item" href="/categories/" title="" >Categories</a><a class="menu-item" href="/tags/" title="" >Tags</a><a class="menu-item" href="https://github.com/ennnbeee/oddsandendpoints-scripts" title="GitHub" 
                rel="noopener noreferrer" target="_blank" ><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 496 512'><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d='M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z'/></svg></a><a class="menu-item" href="/information/" title="Information" ><svg class='icon' xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d='M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z'/></svg></a><button class="menu-item theme-switch tw-w-full" aria-label="Switch Theme">
                <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M8 256c0 136.966 111.033 248 248 248s248-111.034 248-248S392.966 8 256 8 8 119.033 8 256zm248 184V72c101.705 0 184 82.311 184 184 0 101.705-82.311 184-184 184z"/></svg>
            </button></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div><main class="tw-mx-4"><div class="toc print:!tw-hidden" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#cis-level-1-issues">CIS Level 1 Issues</a>
      <ul>
        <li><a href="#user-rights-assignment">User Rights Assignment</a></li>
        <li><a href="#miscellaneous-settings">Miscellaneous Settings</a></li>
        <li><a href="#windows-edition-requirements">Windows Edition Requirements</a></li>
        <li><a href="#user-settings">User Settings</a></li>
      </ul>
    </li>
    <li><a href="#cis-level-1-settings">CIS Level 1 Settings</a>
      <ul>
        <li><a href="#local-administrator-password-solution">Local Administrator Password Solution</a></li>
        <li><a href="#windows-updates-and-delivery-optimisation">Windows Updates and Delivery Optimisation</a></li>
        <li><a href="#microsoft-store">Microsoft Store</a></li>
        <li><a href="#windows-defender">Windows Defender</a></li>
        <li><a href="#windows-system-services">Windows System Services</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
    </div><dialog id="toc-dialog" class="tw-max-w-full tw-w-full tw-max-h-full tw-h-full tw-ml-16">
        <div class="toc tw-mx-4 tw-max-w-full">
            <h2 class="tw-mx-0 tw-my-6 tw-uppercase tw-text-2xl">Contents</h2>
            <div class="toc-content"><nav id="TableOfContents">
  <ul>
    <li><a href="#cis-level-1-issues">CIS Level 1 Issues</a>
      <ul>
        <li><a href="#user-rights-assignment">User Rights Assignment</a></li>
        <li><a href="#miscellaneous-settings">Miscellaneous Settings</a></li>
        <li><a href="#windows-edition-requirements">Windows Edition Requirements</a></li>
        <li><a href="#user-settings">User Settings</a></li>
      </ul>
    </li>
    <li><a href="#cis-level-1-settings">CIS Level 1 Settings</a>
      <ul>
        <li><a href="#local-administrator-password-solution">Local Administrator Password Solution</a></li>
        <li><a href="#windows-updates-and-delivery-optimisation">Windows Updates and Delivery Optimisation</a></li>
        <li><a href="#microsoft-store">Microsoft Store</a></li>
        <li><a href="#windows-defender">Windows Defender</a></li>
        <li><a href="#windows-system-services">Windows System Services</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
        </div>
    </dialog><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single print:!tw-w-full print:!tw-max-w-none print:!tw-m-0 print:!tw-p-0"><h1 class="single-title" data-pagefind-meta="date:15 July 2024" data-pagefind-body>Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows 11</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class='author'>
        <span class='screen-reader-text'>  </span><a href='https://www.oddsandendpoints.co.uk/authors/nick-benton/'><img class="tw-inline-block tw-max-h-4 tw-rounded-full tw-translate-y-[-2px] tw-mr-1"  src=/img/ennbee.png   alt="Nick Benton avatar" height="16" width="16">Nick Benton</a></span>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">category <a href="/categories/windows/"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M464 128H272l-54.63-54.63c-6-6-14.14-9.37-22.63-9.37H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V176c0-26.51-21.49-48-48-48zm0 272H48V112h140.12l54.63 54.63c6 6 14.14 9.37 22.63 9.37H464v224z"/></svg>Windows</a></span>&nbsp;<span class="post-category">and</span>&nbsp;<span class="post-series">series <a href="/series/patching-gaps-in-the-cis-windows-11-benchmark/"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M464 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V80c0-26.51-21.49-48-48-48zm-6 400H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h404a6 6 0 0 1 6 6v340a6 6 0 0 1-6 6zm-42-92v24c0 6.627-5.373 12-12 12H204c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h200c6.627 0 12 5.373 12 12zm0-96v24c0 6.627-5.373 12-12 12H204c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h200c6.627 0 12 5.373 12 12zm0-96v24c0 6.627-5.373 12-12 12H204c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h200c6.627 0 12 5.373 12 12zm-252 12c0 19.882-16.118 36-36 36s-36-16.118-36-36 16.118-36 36-36 36 16.118 36 36zm0 96c0 19.882-16.118 36-36 36s-36-16.118-36-36 16.118-36 36-36 36 16.118 36 36zm0 96c0 19.882-16.118 36-36 36s-36-16.118-36-36 16.118-36 36-36 36 16.118 36 36z"/></svg>Patching Gaps in the CIS Windows 11 Benchmark</a></span></div>
            <div class="post-meta-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z"/></svg>&nbsp;<time datetime="15 July 2024">15 July 2024</time>&nbsp;</div>
        </div><div class="featured-image"><img  loading="eager" src=/posts/windows-cis-patching-gaps-part3/featured.png   alt="Updating the Center for Internet Security (CIS) benchmark build kit for Windows 11 in Microsoft Intune for level 1 security settings." height="500" width="1000"></div><div class="details series-nav open">
                                <div class="details-summary series-title">
                                    <span>Series - Patching Gaps in the CIS Windows 11 Benchmark</span>
                                    <span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
                                </div>
                                <div class="details-content series-content">
                                    <nav>
                                        <ul>
                                                    <li><a href="/posts/windows-cis-patching-gaps-part1/">Patching Gaps in the CIS Windows 11 Benchmark - BitLocker</a></li>
                                                    <li><a href="/posts/windows-cis-patching-gaps-part2/">Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows Autopilot</a></li><li><span class="active">Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows 11</span></li>
                                                    <li><a href="/posts/windows-cis-patching-gaps-part4/">Patching Gaps in the CIS Windows 11 Benchmark - Level 2 Windows 11</a></li></ul>
                                    </nav>
                                </div>
                            </div><div class="details toc print:!tw-block" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cis-level-1-issues">CIS Level 1 Issues</a>
      <ul>
        <li><a href="#user-rights-assignment">User Rights Assignment</a></li>
        <li><a href="#miscellaneous-settings">Miscellaneous Settings</a></li>
        <li><a href="#windows-edition-requirements">Windows Edition Requirements</a></li>
        <li><a href="#user-settings">User Settings</a></li>
      </ul>
    </li>
    <li><a href="#cis-level-1-settings">CIS Level 1 Settings</a>
      <ul>
        <li><a href="#local-administrator-password-solution">Local Administrator Password Solution</a></li>
        <li><a href="#windows-updates-and-delivery-optimisation">Windows Updates and Delivery Optimisation</a></li>
        <li><a href="#microsoft-store">Microsoft Store</a></li>
        <li><a href="#windows-defender">Windows Defender</a></li>
        <li><a href="#windows-system-services">Windows System Services</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content" data-pagefind-body><p>With the investigation into the impact of the CIS benchmark on <a href="/posts/windows-cis-patching-gaps-part1" rel="noopener" target="_blank">BitLocker</a> and <a href="/posts/windows-cis-patching-gaps-part2" rel="noopener" target="_blank">Windows Autopilot</a> now a fond and distant memory, it&rsquo;s time for me to stand <a href="https://www.linkedin.com/in/jonathan-fallis" target="_blank" rel="noopener noreferrer">Jonathan</a> down (it was his Birthday after all, <em>and</em> he has his own <a href="https://deploymentshare.com/" target="_blank" rel="noopener noreferrer">content</a> to create), pull up my sleeves, and get to testing the CIS Level 1 settings across the full Windows 11 operating system itself.</p>
<p>This decision to go it alone, had absolutely nothing to do with me already knowing that there were more missing settings in the benchmark <a href="/posts/windows-cis-patching-gaps-part1/#cis-build-kits" rel="noopener" target="_blank">build kit</a> than settings that actually break Windows 11, I promise 🤫.</p>
<p>So what <em>is</em> the CIS Level 1 benchmark missing?</p>
<div class="details admonition note open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg></span>Note<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">As Custom Profile settings are on their way out (see Message Centre MC822716 and this <a href="https://ourcloudnetwork.com/microsoft-to-start-blocking-custom-oma-uri-settings-in-intune/" target="_blank" rel="noopener noreferrer">post</a> by <a href="https://www.linkedin.com/in/danielbradley2/" target="_blank" rel="noopener noreferrer">Daniel Bradley</a>) this post has been updated, along with the exported profiles, to use Settings Catalog profiles.</div></div></div>
<h2 id="cis-level-1-issues" class="headerLink">
    <a href="#cis-level-1-issues" class="header-mark"></a>1 CIS Level 1 Issues</h2><p>Well probably a few things, but let&rsquo;s sadly look at the settings in the CIS Level 1 benchmark that are going to cause some headaches across Windows 11.</p>
<h3 id="user-rights-assignment" class="headerLink">
    <a href="#user-rights-assignment" class="header-mark"></a>1.1 User Rights Assignment</h3><p>It looks like when configuring <a href="https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/security-policy-settings/user-rights-assignment" target="_blank" rel="noopener noreferrer">User Rights</a> in the Microsoft Intune benchmark, CIS &ldquo;did a Microsoft&rdquo;, and forgot that languages other than English are used across the vanilla Windows 11 operating system, just like the initial release of the <a href="https://learn.microsoft.com/en-us/mem/intune/protect/security-baseline-settings-mdm-all?pivots=mdm-23h2" target="_blank" rel="noopener noreferrer">Security Baseline for Windows 11 23H2</a> identified by <a href="https://www.linkedin.com/in/skiptotheendpoint/" target="_blank" rel="noopener noreferrer">James Robinson</a>:</p>
<blockquote class="twitter-tweet" data-dnt="true"><p lang="en" dir="ltr">Trying to apply the new 23H2 <a href="https://twitter.com/hashtag/Intune?src=hash&amp;ref_src=twsrc%5Etfw">#Intune</a> Baseline and using a non-English OS? You&#39;ll probably break the ability to log into devices because the group names are localised.<a href="https://twitter.com/IntuneSuppTeam?ref_src=twsrc%5Etfw">@IntuneSuppTeam</a> These need changing to the equivalent well-known SID or a lot of devices are gonna go pop. <a href="https://t.co/zY7yWfR3yl">pic.twitter.com/zY7yWfR3yl</a></p>&mdash; James Robinson | MVP (@SkipToEndpoint) <a href="https://twitter.com/SkipToEndpoint/status/1776643614354927723?ref_src=twsrc%5Etfw">April 6, 2024</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>In short, the CIS policy uses english language names, instead of the <a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-identifiers" target="_blank" rel="noopener noreferrer">well-known SIDs</a> across all of the User Rights settings, meaning operating systems in a non-english language will hit some issues, mainly with users actually being able to logon to the device.</p>
<p>Microsoft fixed this slight oversight pretty sharpish, however the same can&rsquo;t be said for CIS 👀.</p>
<p>To give you a sample of the User Rights assignment policy, have a look at the below, covering some of the settings and associated account names in english:</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) User Rights - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Access From Network</td>
            <td style="text-align: left"><code>Administrators, Remote Desktop Users</code></td>
        </tr>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Allow Local Log On</td>
            <td style="text-align: left"><code>Administrators, Users</code></td>
        </tr>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Create Global Objects</td>
            <td style="text-align: left"><code>Administrators, LOCAL SERVICE, NETWORK SERVICE, SERVICE</code></td>
        </tr>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Deny Access From Network</td>
            <td style="text-align: left"><code>Guests, Local account</code></td>
        </tr>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Increase Scheduling Priority</td>
            <td style="text-align: left"><code>Administrators, Window Manager\Window Manager Group</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p>Compared with the below extract of the updated policy, which has been amended to support the use of the SIDs:</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) User Rights Global - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Access From Network</td>
            <td style="text-align: left"><code>*S-1-5-32-544, *S-1-5-32-555</code></td>
        </tr>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Allow Local Log On</td>
            <td style="text-align: left"><code>*S-1-5-32-544, *S-1-5-32-545</code></td>
        </tr>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Create Global Objects</td>
            <td style="text-align: left"><code>*S-1-5-32-544, *S-1-5-19, *S-1-5-20, *S-1-5-6</code></td>
        </tr>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Deny Access From Network</td>
            <td style="text-align: left"><code>*S-1-5-32-546, *S-1-5-113</code></td>
        </tr>
        <tr>
            <td style="text-align: left">User Rights</td>
            <td style="text-align: left">Increase Scheduling Priority</td>
            <td style="text-align: left"><code>*S-1-5-32-544, *S-1-5-90-0</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p>If we just applied and trusted CIS here, then it is quite likely that for non-English operating systems, users would not have been able to sign-in to their Windows device.</p>
<div class="details admonition info open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg></span>Info<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">You can import the updated version of the <a href="https://github.com/ennnbeee/oddsandendpoints-scripts/tree/main/Intune/Configuration/CIS/Windows/L1" target="_blank" rel="noopener noreferrer">CIS (L1) User Rights Global - Windows 11 Intune 3.0.1</a> profile into your Microsoft Intune tenant instead of manually updating the profile, like we had to 🙃.</div></div></div>
<p>Edited&hellip;</p>
<div class="details admonition note open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg></span>Note<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">Thanks to <a href="https://github.com/jimmywinberg" target="_blank" rel="noopener noreferrer">Jimmy Winberg</a> in the comments, the areas in the CIS profile that reference a null identifier, have now been updated to use the <a href="https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-identifiers#well-known-sids" target="_blank" rel="noopener noreferrer">NULL SID</a> <code>S-1-0-0</code> to stop errors in the event logs.</div></div></div>
<h3 id="miscellaneous-settings" class="headerLink">
    <a href="#miscellaneous-settings" class="header-mark"></a>1.2 Miscellaneous Settings</h3><p><del>These settings that exist in the benchmark document, can only, as of today, be added into Microsoft Intune using a <a href="https://learn.microsoft.com/en-us/mem/intune/configuration/custom-settings-configure" target="_blank" rel="noopener noreferrer">Custom Profile</a> which should be pretty easy (foreshadowing).</del></p>
<div class="details admonition note open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg></span>Note<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">This setting now exists within <strong>Settings Catalog</strong>, so we no longer need a Custom Profile.</div></div></div>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-misc.png" title="CIS Level 1 Miscellaneous settings" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-misc.png" data-sub-html="<h2>CIS Level 1 Miscellaneous settings document.</h2><p>CIS Level 1 Miscellaneous settings</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-misc.png   alt="CIS Level 1 Miscellaneous settings" height="230" width="850"></a><figcaption class="image-caption">CIS Level 1 Miscellaneous settings document.</figcaption>
</figure>

</p>
<p>So we should create a new profile to capture the three CIS Level 1 settings detailed in the document with the below Settings Catalog settings.</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Level 1 Misc - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Experience</td>
            <td style="text-align: left">Allow Windows Consumer Features</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Microsoft App Store</td>
            <td style="text-align: left">Block Non Admin User Install</td>
            <td style="text-align: left"><code>Allow</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Wi-Fi Settings</td>
            <td style="text-align: left">Allow Auto Connect To Wi Fi Sense Hotspots</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
    </tbody>
  </table>
</div>
<div class="details admonition info open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg></span>Info<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">You can now import the <a href="https://github.com/ennnbeee/oddsandendpoints-scripts/tree/main/Intune/Configuration/CIS/Windows/L1" target="_blank" rel="noopener noreferrer">CIS (L1) Level 1 Misc - Windows 11 Intune 3.0.1</a> into your Microsoft Intune tenant instead of having to use a Custom profile.</div></div></div>
<p>For reference, the below are the legacy custom profiles settings.</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Name</th>
            <th style="text-align: left">OMA-URI</th>
            <th style="text-align: left">Data Type</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-applicationmanagement#blocknonadminuserinstall" target="_blank" rel="noopener noreferrer">BlockNonAdminUserInstall</a></td>
            <td style="text-align: left"><code>./Device/Vendor/MSFT/Policy/Config/ApplicationManagement/BlockNonAdminUserInstall</code></td>
            <td style="text-align: left">Integer</td>
            <td style="text-align: left"><code>1</code></td>
        </tr>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-experience#allowwindowsconsumerfeatures" target="_blank" rel="noopener noreferrer">AllowWindowsConsumerFeatures</a></td>
            <td style="text-align: left"><code>./Device/Vendor/MSFT/Policy/Config/Experience/AllowWindowsConsumerFeatures</code></td>
            <td style="text-align: left">Integer</td>
            <td style="text-align: left"><code>0</code></td>
        </tr>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-wifi#allowautoconnecttowifisensehotspots" target="_blank" rel="noopener noreferrer">AllowAutoConnectToWiFiSenseHotspots</a></td>
            <td style="text-align: left"><code>./Device/Vendor/MSFT/Policy/Config/Wifi/AllowAutoConnectToWiFiSenseHotspots</code></td>
            <td style="text-align: left">Integer</td>
            <td style="text-align: left"><code>0</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p>Anyone spot a problem? I&rsquo;ll give you a minute.</p>
<p>Now we can&rsquo;t blame CIS for the issues their recommended settings cause, as this one fully goes to Microsoft. Devices getting the setting <strong>BlockNonAdminUserInstall</strong> set to enabled, causes <a href="https://www.theregister.com/2024/06/19/problems_upgrading_win_11_pro/" target="_blank" rel="noopener noreferrer">issues with the Photos app</a> on the device for devices running the <a href="https://support.microsoft.com/en-gb/topic/april-9-2024-kb5036893-os-builds-22621-3447-and-22631-3447-a674a67b-85f5-4a40-8d74-5f8af8ead5bb" target="_blank" rel="noopener noreferrer">April 2024 patch</a>.</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Level 1 Misc - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Name</th>
            <th style="text-align: left">OMA-URI</th>
            <th style="text-align: left">Data Type</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-applicationmanagement#blocknonadminuserinstall" target="_blank" rel="noopener noreferrer">BlockNonAdminUserInstall</a></td>
            <td style="text-align: left"><code>./Device/Vendor/MSFT/Policy/Config/ApplicationManagement/BlockNonAdminUserInstall</code></td>
            <td style="text-align: left">Integer</td>
            <td style="text-align: left"><code>1</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p>We also can&rsquo;t blame CIS for both <strong>AllowWindowsConsumerFeatures</strong> and <strong>BlockNonAdminUserInstall</strong> failing to apply to devices either, as due to the <a href="https://support.microsoft.com/en-gb/topic/june-11-2024-kb5039212-os-builds-22621-3737-and-22631-3737-d7f574c0-2b13-48ca-a9fc-a63093b1a2c2" target="_blank" rel="noopener noreferrer">June 2024 patch</a> devices which <em>should</em> be activated to <strong>Windows 11 Enterprise</strong> as part of subscription activation, don&rsquo;t, leaving devices at their original Windows edition, in this case Windows Pro.</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-miscerror.png" title="CIS Level 1 Miscellaneous settings error" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-miscerror.png" data-sub-html="<h2>CIS Level 1 Miscellaneous setting custom profile assignment error.</h2><p>CIS Level 1 Miscellaneous settings error</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-miscerror.png   alt="CIS Level 1 Miscellaneous settings error" height="375" width="1118"></a><figcaption class="image-caption">CIS Level 1 Miscellaneous setting custom profile assignment error.</figcaption>
</figure>

</p>
<p>Meaning that neither <a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-experience#allowwindowsconsumerfeatures" target="_blank" rel="noopener noreferrer">AllowWindowsConsumerFeatures</a> and <a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-applicationmanagement#blocknonadminuserinstall" target="_blank" rel="noopener noreferrer">BlockNonAdminUserInstall</a> will apply to non-Enterprise editions of Windows:</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-cspnonadeds.png" title="PolicyCSP Windows Edition Settings" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-cspnonadeds.png" data-sub-html="<h2>PolicyCSP Edition settings for BlockNonAdminUserInstall</h2><p>PolicyCSP Windows Edition Settings</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-cspnonadeds.png   alt="PolicyCSP Windows Edition Settings" height="200" width="900"></a><figcaption class="image-caption">PolicyCSP Edition settings for BlockNonAdminUserInstall</figcaption>
</figure>

</p>
<p>Are there any other settings in the benchmark require specific Windows editions?</p>
<h3 id="windows-edition-requirements" class="headerLink">
    <a href="#windows-edition-requirements" class="header-mark"></a>1.3 Windows Edition Requirements</h3><p>The Windows subscription activation issues, and subsequent edition downgrade, highlighted something I hadn&rsquo;t considered, just how many settings in the CIS 3.0.1 benchmark for Level 1 actually require an Enterprise or Education editions of Windows, or at least just don&rsquo;t work on Pro editions?</p>
<p>Well I&rsquo;m not going to count them for you (I actually did, it&rsquo;s seven).</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Profile</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-experience#allowwindowsconsumerfeatures" target="_blank" rel="noopener noreferrer">AllowWindowsConsumerFeatures</a></td>
            <td style="text-align: left">CIS (L1) Level 1 Misc - Windows 11 Intune 3.0.1</td>
        </tr>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-applicationmanagement#blocknonadminuserinstall" target="_blank" rel="noopener noreferrer">BlockNonAdminUserInstall</a></td>
            <td style="text-align: left">CIS (L1) Level 1 Misc - Windows 11 Intune 3.0.1</td>
        </tr>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-experience#allowspotlightcollection" target="_blank" rel="noopener noreferrer">Allow Spotlight Collection (User)</a></td>
            <td style="text-align: left">CIS (L1) Section 22 - 80 (User) - Windows 11 Intune 3.0.1</td>
        </tr>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-experience#disableconsumeraccountstatecontent" target="_blank" rel="noopener noreferrer">Disable Consumer Account State Content</a></td>
            <td style="text-align: left">CIS (L1) Section 22 - 80 - Windows 11 Intune 3.0.1</td>
        </tr>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-applicationmanagement#requireprivatestoreonly" target="_blank" rel="noopener noreferrer">Require Private Store Only</a></td>
            <td style="text-align: left">CIS (L1) Section 22 - 80 - Windows 11 Intune 3.0.1</td>
        </tr>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-deviceguard#lsacfgflags" target="_blank" rel="noopener noreferrer">Credential Guard</a></td>
            <td style="text-align: left">CIS (L1) Virtualization Based Technology - Windows 11 Intune 3.0.1</td>
        </tr>
        <tr>
            <td style="text-align: left"><a href="https://learn.microsoft.com/en-us/windows/client-management/mdm/policy-csp-deviceguard#requireplatformsecurityfeatures" target="_blank" rel="noopener noreferrer">Require Platform Security Features</a></td>
            <td style="text-align: left">CIS (L1) Virtualization Based Technology - Windows 11 Intune 3.0.1</td>
        </tr>
    </tbody>
  </table>
</div>
<p>If you&rsquo;ve only got devices running Windows Professional, you can say goodbye to blocking the Windows Consumer Features, or by requiring the Windows Private Store, blocking access to the store itself, or worse, device security settings in <strong>Credential Guard</strong> and <strong>Secure Boot</strong> not applying.</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-entna.png" title="Enterprise Edition settings" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-entna.png" data-sub-html="<h2>Settings that require Windows Enterprise editions to apply to a device.</h2><p>Enterprise Edition settings</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-entna.png   alt="Enterprise Edition settings" height="268" width="843"></a><figcaption class="image-caption">Settings that require Windows Enterprise editions to apply to a device.</figcaption>
</figure>

</p>
<p>So this leaves a bit of a gap in the Level 1 benchmark for these Windows Professional cloud native devices, or does it?</p>
<p>Well no, we just can&rsquo;t use Microsoft Intune native settings to configure them. What we can do is use our favourite tooling <del>Group Policy</del>, PowerShell, to go and set some corresponding registry settings to ensure we&rsquo;re in-line with the benchmark.</p>
<p>We can create a PowerShell script to create the six, (yes I said six), registry settings. These exist in the <a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/install/hklm-system-currentcontrolset-services-registry-tree" target="_blank" rel="noopener noreferrer">HKLM</a> registry hive, so we can happily update them using a PowerShell and a Platform Script in Microsoft Intune.</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Windows Pro Settings - Windows 11 Intune 3.0.1.ps1</em></p>








  
  

  
    
  

  

  
  
  
  <div class="code-block highlight is-open show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">PowerShell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-21" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="c"># Windows Pro Device Settings</span>
</span></span><span class="line"><span class="cl"><span class="nv">$regSettings</span> <span class="p">=</span> <span class="vm">@</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nv">$regSettings</span> <span class="p">+=</span> <span class="p">[</span><span class="no">pscustomobject</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span><span class="n">path</span> <span class="p">=</span> <span class="s1">&#39;HKLM:\Software\Policies\Microsoft\Windows\CloudContent&#39;</span><span class="p">;</span> <span class="n">name</span> <span class="p">=</span> <span class="s1">&#39;DisableWindowsConsumerFeatures&#39;</span><span class="p">;</span> <span class="n">value</span> <span class="p">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span> <span class="nb">type </span><span class="p">=</span> <span class="s1">&#39;DWord&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$regSettings</span> <span class="p">+=</span> <span class="p">[</span><span class="no">pscustomobject</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span><span class="n">path</span> <span class="p">=</span> <span class="s1">&#39;HKLM:\SOFTWARE\Policies\Microsoft\Windows\CloudContent&#39;</span><span class="p">;</span> <span class="n">name</span> <span class="p">=</span> <span class="s1">&#39;DisableConsumerAccountStateContent&#39;</span><span class="p">;</span> <span class="n">value</span> <span class="p">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span> <span class="nb">type </span><span class="p">=</span> <span class="s1">&#39;DWord&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$regSettings</span> <span class="p">+=</span> <span class="p">[</span><span class="no">pscustomobject</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span><span class="n">path</span> <span class="p">=</span> <span class="s1">&#39;HKLM:\Software\Policies\Microsoft\Windows\Appx&#39;</span><span class="p">;</span> <span class="n">name</span> <span class="p">=</span> <span class="s1">&#39;BlockNonAdminUserInstall&#39;</span><span class="p">;</span> <span class="n">value</span> <span class="p">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span> <span class="nb">type </span><span class="p">=</span> <span class="s1">&#39;DWord&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$regSettings</span> <span class="p">+=</span> <span class="p">[</span><span class="no">pscustomobject</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span><span class="n">path</span> <span class="p">=</span> <span class="s1">&#39;HKLM:\Software\Policies\Microsoft\WindowsStore&#39;</span><span class="p">;</span> <span class="n">name</span> <span class="p">=</span> <span class="s1">&#39;RequirePrivateStoreOnly&#39;</span><span class="p">;</span> <span class="n">value</span> <span class="p">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span> <span class="nb">type </span><span class="p">=</span> <span class="s1">&#39;DWord&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$regSettings</span> <span class="p">+=</span> <span class="p">[</span><span class="no">pscustomobject</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span><span class="n">path</span> <span class="p">=</span> <span class="s1">&#39;HKLM:\Software\Policies\Microsoft\Windows\DeviceGuard&#39;</span><span class="p">;</span> <span class="n">name</span> <span class="p">=</span> <span class="s1">&#39;LsaCfgFlags&#39;</span><span class="p">;</span> <span class="n">value</span> <span class="p">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span> <span class="nb">type </span><span class="p">=</span> <span class="s1">&#39;DWord&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nv">$regSettings</span> <span class="p">+=</span> <span class="p">[</span><span class="no">pscustomobject</span><span class="p">]</span><span class="vm">@</span><span class="p">{</span><span class="n">path</span> <span class="p">=</span> <span class="s1">&#39;HKLM:\Software\Policies\Microsoft\Windows\DeviceGuard&#39;</span><span class="p">;</span> <span class="n">name</span> <span class="p">=</span> <span class="s1">&#39;RequirePlatformSecurityFeatures&#39;</span><span class="p">;</span> <span class="n">value</span> <span class="p">=</span> <span class="s1">&#39;1&#39;</span><span class="p">;</span> <span class="nb">type </span><span class="p">=</span> <span class="s1">&#39;DWord&#39;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">Try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$regSetting</span> <span class="k">in</span> <span class="nv">$regSettings</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(!(</span><span class="nb">Test-Path</span> <span class="vm">$</span><span class="p">(</span><span class="nv">$regSetting</span><span class="p">.</span><span class="n">path</span><span class="p">))){</span>
</span></span><span class="line"><span class="cl">            <span class="nb">New-Item</span> <span class="n">-Path</span> <span class="vm">$</span><span class="p">(</span><span class="nv">$regSetting</span><span class="p">.</span><span class="n">path</span><span class="p">)</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nb">New-ItemProperty</span> <span class="n">-Path</span> <span class="vm">$</span><span class="p">(</span><span class="nv">$regSetting</span><span class="p">.</span><span class="n">path</span><span class="p">)</span> <span class="n">-Name</span> <span class="vm">$</span><span class="p">(</span><span class="nv">$regSetting</span><span class="p">.</span><span class="n">name</span><span class="p">)</span> <span class="n">-Value</span> <span class="vm">$</span><span class="p">(</span><span class="nv">$regSetting</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="n">-PropertyType</span> <span class="vm">$</span><span class="p">(</span><span class="nv">$regSetting</span><span class="p">.</span><span class="n">type</span><span class="p">)</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">Exit</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">Catch</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Error</span> <span class="nv">$_</span><span class="p">.</span><span class="py">ErrorDetails</span>
</span></span><span class="line"><span class="cl">    <span class="n">Exit</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</div>



<p>Sadly, the <strong>Allow Spotlight Collection</strong> setting, only exists in the <a href="https://admx.help/?Category=Windows_11_2022&amp;Policy=Microsoft.Policies.CloudContent::DisableSpotlightCollectionOnDesktop" target="_blank" rel="noopener noreferrer">HKCU</a> part of the registry, and sits under the <strong>HKCU:\Software\Policies</strong> key which standard users don&rsquo;t have access to write to. So we don&rsquo;t have a way to create this new item using PowerShell and Platform Scripts natively.</p>
<div class="details admonition note open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg></span>Note<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">Jonathan has informed me that you could apply the <strong>Allow Spotlight Collection</strong> setting in <strong>HKCU</strong> using the <a href="https://psappdeploytoolkit.com/" target="_blank" rel="noopener noreferrer">PSAppDeployToolkit</a>, specifically the <a href="https://psappdeploytoolkit.com/docs/reference/functions/Invoke-HKCURegistrySettingsForAllUsers/" target="_blank" rel="noopener noreferrer">Invoke-HKCURegistrySettingsForAllUsers</a> functionality, so off you trot and do that.</div></div></div>
<p>The rest of registry entries in <strong>CIS (L1) Windows Pro Settings - Windows 11 Intune 3.0.1.ps1</strong> are fine, so deploy them to your devices using a Platform Script:</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-entscript.png" title="CIS (L1) Windows Pro Settings - Windows 11 Intune 3.0.1.ps1" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-entscript.png" data-sub-html="<h2>Platform Script configuring Windows Enterprise only Policy CSP Settings.</h2><p>CIS (L1) Windows Pro Settings - Windows 11 Intune 3.0.1.ps1</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-entscript.png   alt="CIS (L1) Windows Pro Settings - Windows 11 Intune 3.0.1.ps1" height="541" width="921"></a><figcaption class="image-caption">Platform Script configuring Windows Enterprise only Policy CSP Settings.</figcaption>
</figure>

</p>
<p>Using Platform Scripts, we&rsquo;re currently limited to assignments without <a href="https://learn.microsoft.com/en-us/mem/intune/fundamentals/filters" target="_blank" rel="noopener noreferrer">Device Filters</a>, so we don&rsquo;t have a way to target just Windows devices that aren&rsquo;t on Windows 11 Enterprise/Education (operating system edition isn&rsquo;t an attribute stored in the Entra ID computer object, so no Dynamic Groups either).</p>
<p>Seeing the script do it&rsquo;s thing, we now have the configured registry settings, (at least those in HKLM), set on the device, with the expected behaviour of the CIS benchmark:</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-regcloudcontent.png" title="Windows Pro registry settings" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-regcloudcontent.png" data-sub-html="<h2>Windows Pro registry settings under HKLM:\Software\Policies\Microsoft\Windows\CloudContent.</h2><p>Windows Pro registry settings</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-regcloudcontent.png   alt="Windows Pro registry settings" height="263" width="1122"></a><figcaption class="image-caption">Windows Pro registry settings under HKLM:\Software\Policies\Microsoft\Windows\CloudContent.</figcaption>
</figure>

</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-regappx.png" title="Windows Pro registry settings" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-regappx.png" data-sub-html="<h2>Windows Pro registry settings under HKLM:\Software\Policies\Microsoft\Windows\Appx.</h2><p>Windows Pro registry settings</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-regappx.png   alt="Windows Pro registry settings" height="210" width="1210"></a><figcaption class="image-caption">Windows Pro registry settings under HKLM:\Software\Policies\Microsoft\Windows\Appx.</figcaption>
</figure>

</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-regwindowsstore.png" title="Windows Pro registry settings" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-regwindowsstore.png" data-sub-html="<h2>Windows Pro registry settings under HKLM:\Software\Policies\Microsoft\WindowsStore.</h2><p>Windows Pro registry settings</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-regwindowsstore.png   alt="Windows Pro registry settings" height="217" width="989"></a><figcaption class="image-caption">Windows Pro registry settings under HKLM:\Software\Policies\Microsoft\WindowsStore.</figcaption>
</figure>

</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-regdeviceguard.png" title="Windows Pro registry settings" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-regdeviceguard.png" data-sub-html="<h2>Windows Pro registry settings under HKLM:\Software\Policies\Microsoft\Windows\DeviceGuard.</h2><p>Windows Pro registry settings</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-regdeviceguard.png   alt="Windows Pro registry settings" height="243" width="979"></a><figcaption class="image-caption">Windows Pro registry settings under HKLM:\Software\Policies\Microsoft\Windows\DeviceGuard.</figcaption>
</figure>

</p>
<div class="details admonition info open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg></span>Info<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">The <a href="https://github.com/ennnbeee/oddsandendpoints-scripts/blob/main/Intune/PlatformScripts/PowerShell/CIS/L1/" target="_blank" rel="noopener noreferrer">CIS (L1) Windows Pro Settings - Windows 11 Intune 3.0.1.ps1</a> PowerShell scripts should be added as Platform scripts in Microsoft Intune.</div></div></div>
<h3 id="user-settings" class="headerLink">
    <a href="#user-settings" class="header-mark"></a>1.4 User Settings</h3><p>Any other assignment issues you want to throw our way and not document CIS? No? Are you sure?</p>
<p>Having reviewed the device assignment states after by default assigning the imported build kit settings to groups of devices in Microsoft Intune, I was left pondering as to why CIS wouldn&rsquo;t mention that there are User only settings in each of the profiles.</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-userna.png" title="User Settings Not Applicable" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-userna.png" data-sub-html="<h2>User Only settings not applying to the device context in Microsoft Intune.</h2><p>User Settings Not Applicable</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-userna.png   alt="User Settings Not Applicable" height="370" width="788"></a><figcaption class="image-caption">User Only settings not applying to the device context in Microsoft Intune.</figcaption>
</figure>

</p>
<p>This isn&rsquo;t such a bad thing, as you&rsquo;re just going to get a <strong>Not Applicable</strong> state when assigned to the SYSTEM context of the device, the user on the device will be fine though.</p>
<p>However, for good practice assignment, we should split out the user settings from the profiles, and create new ones, allowing a consistent assignment of settings.</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Admin Templates - Windows Components (User) - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Administrative Templates &gt; Windows Components &gt; Network Sharing</td>
            <td style="text-align: left">Prevent users from sharing files within their profile. (User)</td>
            <td style="text-align: left"><code>Enabled</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Administrative Templates &gt; Windows Components &gt; Attachment Manager</td>
            <td style="text-align: left">Do not preserve zone information in file attachments (User)</td>
            <td style="text-align: left"><code>Disabled</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Administrative Templates &gt; Windows Components &gt; Attachment Manager</td>
            <td style="text-align: left">Notify antivirus programs when opening attachments (User)</td>
            <td style="text-align: left"><code>Enabled</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Section 22 - 80 (User) - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Experience</td>
            <td style="text-align: left">Allow Spotlight Collection (User)</td>
            <td style="text-align: left"><code>0</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Microsoft App Store</td>
            <td style="text-align: left">MSI Always Install With Elevated Privileges (User)</td>
            <td style="text-align: left"><code>Disabled</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Administrative Templates &gt; Windows Components &gt; Attachment Manager</td>
            <td style="text-align: left">Notify antivirus programs when opening attachments (User)</td>
            <td style="text-align: left"><code>Enabled</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Section 1 - 3.9.1.1 (User) - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Administrative Templates &gt; Start Menu and Taskbar &gt; Notifications</td>
            <td style="text-align: left">Turn off toast notifications on the lock screen (User)</td>
            <td style="text-align: left"><code>Enabled</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Administrative Templates &gt; Control Panel &gt; Personalization</td>
            <td style="text-align: left">Enable screen saver (User)</td>
            <td style="text-align: left"><code>Enabled</code></td>
        </tr>
    </tbody>
  </table>
</div>
<div class="details admonition info open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg></span>Info<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">The amended profiles and the new user based profiles, <a href="https://github.com/ennnbeee/oddsandendpoints-scripts/tree/main/Intune/Configuration/CIS/Windows/L1" target="_blank" rel="noopener noreferrer">CIS (L1) Admin Templates - Windows Components (User) - Windows 11 Intune 3.0.1</a>, <a href="https://github.com/ennnbeee/oddsandendpoints-scripts/tree/main/Intune/Configuration/CIS/Windows/L1" target="_blank" rel="noopener noreferrer">CIS (L1) Section 22 - 80 (User) - Windows 11 Intune 3.0.1</a> and <a href="https://github.com/ennnbeee/oddsandendpoints-scripts/tree/main/Intune/Configuration/CIS/Windows/L1" target="_blank" rel="noopener noreferrer">CIS (L1) Section 1 - 3.9.1.1 (User) - Windows 11 Intune 3.0.1</a> are available for you to import, don&rsquo;t say I&rsquo;m not kind to you all.</div></div></div>
<h2 id="cis-level-1-settings" class="headerLink">
    <a href="#cis-level-1-settings" class="header-mark"></a>2 CIS Level 1 Settings</h2><p>Now hopefully we&rsquo;re done with settings in the Level 1 benchmark that just don&rsquo;t work properly, we can look at settings that are missing, or settings that are just going to annoy your end-users or support teams 🫠.</p>
<h3 id="local-administrator-password-solution" class="headerLink">
    <a href="#local-administrator-password-solution" class="header-mark"></a>2.1 Local Administrator Password Solution</h3><p>On to recommendations that exist in the Benchmark <a href="https://www.cisecurity.org/benchmark/intune" target="_blank" rel="noopener noreferrer">document</a> but not in the build kit, we can start with <a href="https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-overview" target="_blank" rel="noopener noreferrer">Windows LAPS</a>.</p>
<p>The Windows LAPS settings don&rsquo;t exist in the build kit as it&rsquo;s configured under <a href="https://learn.microsoft.com/en-us/mem/intune/protect/endpoint-security-account-protection-policy" target="_blank" rel="noopener noreferrer">Account Protection</a> in the <a href="https://learn.microsoft.com/en-us/mem/intune/protect/endpoint-security-policy" target="_blank" rel="noopener noreferrer">Endpoint Security</a> section of Microsoft Intune, so I assume CIS just didn&rsquo;t include it as there is no native import functionality.</p>
<p>Taking the information provided in the benchmark document, we need to cover off everything under section <strong>85 Windows LAPS</strong>, as they&rsquo;re all CIS Level 1 settings.</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-laps.png" title="CIS Section 85 Settings" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-laps.png" data-sub-html="<h2>An excerpt from the CIS 3.0.1 benchmark for Windows LAPS.</h2><p>CIS Section 85 Settings</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-laps.png   alt="CIS Section 85 Settings" height="619" width="754"></a><figcaption class="image-caption">An excerpt from the CIS 3.0.1 benchmark for Windows LAPS.</figcaption>
</figure>

</p>
<p>We can easily create a new <strong>Account Protection</strong> policy in Microsoft Intune to meet these requirements, with the settings below:</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Windows LAPS - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">LAPS</td>
            <td style="text-align: left">Backup Directory</td>
            <td style="text-align: left"><code>Backup the password to Azure AD only</code></td>
        </tr>
        <tr>
            <td style="text-align: left">LAPS</td>
            <td style="text-align: left">Password Age Days</td>
            <td style="text-align: left"><code>30 or fewer</code><sup><strong>*</strong></sup></td>
        </tr>
        <tr>
            <td style="text-align: left">LAPS</td>
            <td style="text-align: left">Administrator Account Name</td>
            <td style="text-align: left"><code>Admin</code></td>
        </tr>
        <tr>
            <td style="text-align: left">LAPS</td>
            <td style="text-align: left">Password Complexity</td>
            <td style="text-align: left"><code>Large letters + small letters + numbers + special characters (improved readability)</code></td>
        </tr>
        <tr>
            <td style="text-align: left">LAPS</td>
            <td style="text-align: left">Password Length</td>
            <td style="text-align: left"><code>15 or more</code><sup><strong>*</strong></sup></td>
        </tr>
        <tr>
            <td style="text-align: left">LAPS</td>
            <td style="text-align: left">Post Authentication Actions</td>
            <td style="text-align: left"><code>Reset the password and logoff the managed account (or higher)</code><sup><strong>*</strong></sup></td>
        </tr>
        <tr>
            <td style="text-align: left">LAPS</td>
            <td style="text-align: left">Post Authentication Reset Delay</td>
            <td style="text-align: left"><code>8 (or fewer hours, but not 0)</code><sup><strong>*</strong></sup></td>
        </tr>
    </tbody>
  </table>
</div>
<p><sup>*</sup><em>These are the minimum settings to adhere to the CIS benchmark, so amend as you see fit.</em></p>
<div class="details admonition info open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg></span>Info<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">Don&rsquo;t forget if you are going to use Windows LAPS, that you <a href="https://learn.microsoft.com/en-us/entra/identity/devices/howto-manage-local-admin-passwords#enabling-windows-laps-with-microsoft-entra-id" target="_blank" rel="noopener noreferrer">enable</a> the feature in Entra ID, and review the <a href="https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-overview" target="_blank" rel="noopener noreferrer">requirements</a> to allow you to actually use it on your Windows 11 devices.</div></div></div>
<p>The <strong>CIS (L1) Local Policies Security Options - Windows 11 Intune 3.0.1</strong> CIS policy sets the built-in administrator account name to <strong>Admin</strong>, so make sure either you update the setting below in the imported policy to match any changes to the LAPS setting, or be happy with what it&rsquo;s called:</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Local Policies Security Options - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Local Policies Security Options</td>
            <td style="text-align: left">Accounts Rename Administrator Account</td>
            <td style="text-align: left"><code>Admin</code></td>
        </tr>
    </tbody>
  </table>
</div>
<div class="details admonition info open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg></span>Info<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">We can&rsquo;t export a Endpoint Security profile, even if they&rsquo;re technically Settings Catalog profiles, so we&rsquo;re using the <a href="https://github.com/Micke-K/IntuneManagement" target="_blank" rel="noopener noreferrer">Intune Management</a> tool, allowing you to import the <a href="https://github.com/ennnbeee/oddsandendpoints-scripts/tree/main/Intune/Configuration/CIS/Windows/L1" target="_blank" rel="noopener noreferrer">CIS (L1) Windows LAPS - Windows 11 Intune 3.0.1</a> profile instead of having to create it.</div></div></div>
<h3 id="windows-updates-and-delivery-optimisation" class="headerLink">
    <a href="#windows-updates-and-delivery-optimisation" class="header-mark"></a>2.2 Windows Updates and Delivery Optimisation</h3><p>Is it all good in the world of Windows Update for Business settings in the CIS benchmark? Well kind of, if you want all of your devices to install updates every day, with no phasing, and just blindly update to the latest Feature Update after 180 days.</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Windows Update - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Windows Update For Business</td>
            <td style="text-align: left">Defer Feature Updates Period In Days</td>
            <td style="text-align: left"><code>180</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Windows Update For Business</td>
            <td style="text-align: left">Defer Quality Updates Period (Days)</td>
            <td style="text-align: left"><code>0</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Windows Update For Business</td>
            <td style="text-align: left">Scheduled Install Day</td>
            <td style="text-align: left"><code>Every day</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p>It&rsquo;s not like there&rsquo;s even much room for manoeuvre; the Feature Update deferral is a <em>minimum</em> of 180 days, so you could phase the delivery of Feature Updates at least, but the Quality Update deferral can only be zero days, so out goes the window for any kind of <a href="/posts/flexible-update-deployments/" rel="noopener" target="_blank">phasing</a>.</p>
<p>Maybe CIS has more faith in Windows Updates not breaking devices than others 🫢.</p>
<p>At least there&rsquo;s a setting in the build kit for <a href="https://learn.microsoft.com/en-us/mem/intune/configuration/delivery-optimization-windows" target="_blank" rel="noopener noreferrer">Delivery Optimisation</a>, so all our devices installing Quality and Feature updates at the same time don&rsquo;t smash the WAN connection to bits&hellip;</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Section 22 - 80 - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Delivery Optimization</td>
            <td style="text-align: left">DO Download Mode</td>
            <td style="text-align: left"><code>HTTP only, no peering</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p>Oh.</p>
<p>It&rsquo;s OK, we can have any of the settings available to us in Microsoft Intune, just not <strong>HTTP blended with Internet peering.</strong></p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-docdo.png" title="CIS Delivery Optimisation Settings" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-docdo.png" data-sub-html="<h2>Section 22.1 (L1) Ensure &#39;DO Download Mode&#39; is NOT set to &#39;HTTP blended with Internet Peering&#39;.</h2><p>CIS Delivery Optimisation Settings</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-docdo.png   alt="CIS Delivery Optimisation Settings" height="560" width="700"></a><figcaption class="image-caption">Section 22.1 (L1) Ensure 'DO Download Mode' is NOT set to 'HTTP blended with Internet Peering'.</figcaption>
</figure>

</p>
<p>Just goes to show that you do really need to read the associated CIS Benchmark document along with using the build kit, or just take the word of someone on the internet that things work 😬.</p>
<h3 id="microsoft-store" class="headerLink">
    <a href="#microsoft-store" class="header-mark"></a>2.3 Microsoft Store</h3><p>As mentioned previously, having a Microsoft Intune setting to <strong>Require Private Store Only</strong> is only a Windows Enterprise edition feature, however we sorted that with the PowerShell script, so now that the setting is applying to all devices correctly, it blocks the store.</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Section 22 - 80 - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Microsoft App Store</td>
            <td style="text-align: left">Require Private Store Only</td>
            <td style="text-align: left"><code>Only Private store is enabled.</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p>As there isn&rsquo;t such as thing as a Private Store now the the <a href="https://learn.microsoft.com/en-us/microsoft-store/" target="_blank" rel="noopener noreferrer">Microsoft Store for Business</a> has been retired (has it?), then the outcome of the setting above just blocks access to the store.</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-storeblocked.png" title="Blocked Microsoft Store" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-storeblocked.png" data-sub-html="<h2>The Microsoft Store blocked by the Require Private Store setting in Microsoft Intune.</h2><p>Blocked Microsoft Store</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-storeblocked.png   alt="Blocked Microsoft Store" height="632" width="800"></a><figcaption class="image-caption">The Microsoft Store blocked by the Require Private Store setting in Microsoft Intune.</figcaption>
</figure>

</p>
<p>In the same profile though at least the store apps are being kept up to date:</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Section 22 - 80 - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Microsoft App Store</td>
            <td style="text-align: left">Allow apps from the Microsoft app store to auto update</td>
            <td style="text-align: left"><code>Allowed.</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p>But with no way easy way to check that apps are actually being updated, you&rsquo;d better look at another option to ensure the built-in apps are <a href="/posts/updating-windows-store-apps/" rel="noopener" target="_blank">kept up to date</a> 😉.</p>
<h3 id="windows-defender" class="headerLink">
    <a href="#windows-defender" class="header-mark"></a>2.4 Windows Defender</h3><p>You&rsquo;d think there&rsquo;d be nothing majorly wrong with the <a href="https://www.microsoft.com/en-gb/windows/comprehensive-security" target="_blank" rel="noopener noreferrer">Windows Defender</a> settings in the build kit, or the benchmark document itself, and on first glance all looks well apart from the lack of any kind <a href="https://learn.microsoft.com/en-us/mem/intune/protect/antivirus-microsoft-defender-settings-windows#remediation" target="_blank" rel="noopener noreferrer">remediations</a> to quarantine or delete detected threats.</p>
<p>You might not be using Windows Defender as your primary antivirus solution, so CIS not assuming you are is a good thing.</p>
<p>But based on this, CIS wouldn&rsquo;t include anything in the imported profiles that <em>does</em> require Windows Defender to be acting a as primary solution and/or in active mode though?</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) Defender - Windows 11 Intune 3.0.1</em></p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Category</th>
            <th style="text-align: left">Setting</th>
            <th style="text-align: left">Value</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block executable content from email client and webmail</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block Office applications from injecting code into other processes</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block Office applications from creating executable content</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block abuse of exploited vulnerable signed drivers (Device)</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block persistence through WMI event subscription</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block untrusted and unsigned processes that run from USB</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block JavaScript or VBScript from launching downloaded executable content</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block credential stealing from the Windows local security authority subsystem</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block Adobe Reader from creating child processes</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block all Office applications from creating child processes</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block Office communication application from creating child processes</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block Win32 API calls from Office macros</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
        <tr>
            <td style="text-align: left">Defender</td>
            <td style="text-align: left">Block execution of potentially obfuscated scripts</td>
            <td style="text-align: left"><code>Block</code></td>
        </tr>
    </tbody>
  </table>
</div>
<p>Ah, <strong>13</strong> <a href="https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-deployment" target="_blank" rel="noopener noreferrer">Attack Surface Reduction Rules</a>, and all in <strong>block</strong> mode 


    
    
    
    
    
        
            
        
    

    

    
        
        <img src="/emoji/pikachu_face.png" alt="pikachu_face" title="pikachu_face" class="emoji">
    



, not an <a href="https://learn.microsoft.com/en-gb/defender-endpoint/attack-surface-reduction?WT.mc_id=Portal-fx#audit-mode-for-evaluation" target="_blank" rel="noopener noreferrer">audit</a> setting in sight. Brilliant.</p>
<p>So even if you do meet the <a href="https://learn.microsoft.com/en-us/defender-endpoint/attack-surface-reduction-rules-deployment#attack-surface-reduction-rules-dependencies" target="_blank" rel="noopener noreferrer">dependencies</a> below for the ASR rules to actually apply, they&rsquo;re all going to straight up block everything they find that matches the rules.</p>
<blockquote>
  <p>Microsoft Defender Antivirus must be enabled and configured as primary anti-virus solution, and must be in the following mode:</p>
<ul>
<li>Primary antivirus/antimalware solution</li>
<li>State: Active mode</li>
</ul>

</blockquote><p>Which is another good reason to actually check to see what these build kit profiles are configuring, without blindly applying them to you device estate and being all surprised when stuff stops working.</p>
<h3 id="windows-system-services" class="headerLink">
    <a href="#windows-system-services" class="header-mark"></a>2.5 Windows System Services</h3><p>CIS provide a PowerShell script as part of the Level 1 benchmark to disable some <del>scary looking</del> Windows System Services, specifically the below (even if the Xbox ones are already disabled by <strong>CIS (L1) System Services - Windows 11 Intune 3.0.1</strong>).</p>
<p>The table below details the apparent effect of disabling these services.</p>

<div class="table-wrapper">
  <table>
    <thead>
        <tr>
            <th style="text-align: left">Service Name</th>
            <th style="text-align: left">Service Description</th>
            <th style="text-align: left">Impact</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td style="text-align: left"><code>Browser</code></td>
            <td style="text-align: left">Computer Browser</td>
            <td style="text-align: left">No more discovery of network devices.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>IISADMIN</code></td>
            <td style="text-align: left">IIS Admin Service</td>
            <td style="text-align: left">No SMTP or FTP configuration in IIS.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>irmon</code></td>
            <td style="text-align: left">Infrared monitor service</td>
            <td style="text-align: left">No transfer of data using Infrared.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>SharedAccess</code></td>
            <td style="text-align: left">Internet Connection Sharing</td>
            <td style="text-align: left">No sharing of network connections, bye bye Hyper-V bridging.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>LxssManager</code></td>
            <td style="text-align: left">LxssManager</td>
            <td style="text-align: left">Bye bye Windows Subsystem for Linux.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>FTPSVC</code></td>
            <td style="text-align: left">Microsoft FTP Service</td>
            <td style="text-align: left">Clearly no more FTP servers.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>sshd</code></td>
            <td style="text-align: left">OpenSSH SSH Server</td>
            <td style="text-align: left">Same as above but SSH servers.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>RpcLocator</code></td>
            <td style="text-align: left">Remote Procedure Call (RPC) Locator</td>
            <td style="text-align: left">Nowt, legacy service.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>RemoteAccess</code></td>
            <td style="text-align: left">Routing and Remote Access</td>
            <td style="text-align: left">As on the tin, used for RRAS servers.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>simptcp</code></td>
            <td style="text-align: left">Simple TCP/IP LocalServices$LocalServices</td>
            <td style="text-align: left">Apparently has little use in modern environments, and is an optional Windows feature.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>sacsvr</code></td>
            <td style="text-align: left">Special Administration Console Helper</td>
            <td style="text-align: left">Remote command prompt used as part of Windows Emergency Management Services and Serial Console.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>SSDPSRV</code></td>
            <td style="text-align: left">SSDP Discovery</td>
            <td style="text-align: left">UPnP device discovery is now dead.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>upnphost</code></td>
            <td style="text-align: left">UPnP Device Host</td>
            <td style="text-align: left">UPnP device discovery is still dead.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>WMSvc</code></td>
            <td style="text-align: left">Web Management Service</td>
            <td style="text-align: left">No more management of local web servers.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>WMPNetworkSvc</code></td>
            <td style="text-align: left">Windows Media Player Network Sharing Service</td>
            <td style="text-align: left">No media sharing from Windows Media Player.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>icssvc</code></td>
            <td style="text-align: left">Windows Mobile Hotspot Service</td>
            <td style="text-align: left">No creation of Mobile hotspots.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>W3SVC</code></td>
            <td style="text-align: left">World Wide Web Publishing Service</td>
            <td style="text-align: left">No more local web servers.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>XboxGipSvc</code></td>
            <td style="text-align: left">Xbox Accessory Management Service</td>
            <td style="text-align: left">No playing games.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>XblAuthManager</code></td>
            <td style="text-align: left">Xbox Live Auth Manager</td>
            <td style="text-align: left">No logging into games.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>XblGameSave</code></td>
            <td style="text-align: left">Xbox Live Game Save</td>
            <td style="text-align: left">No saving games.</td>
        </tr>
        <tr>
            <td style="text-align: left"><code>XboxNetApiSvc</code></td>
            <td style="text-align: left">Xbox Live Networking Service</td>
            <td style="text-align: left">No games.</td>
        </tr>
    </tbody>
  </table>
</div>
<p>So happy with all the functionality that is being prevented, we can deploy the provided script using Microsoft Intune Platform Scripts with deployment settings looking something like this:</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-l1script.png" title="CIS Level 1 System Services Script" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-l1script.png" data-sub-html="<h2>CIS Level 1 services PowerShell Script in Microsoft Intune.</h2><p>CIS Level 1 System Services Script</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-l1script.png   alt="CIS Level 1 System Services Script" height="548" width="924"></a><figcaption class="image-caption">CIS Level 1 services PowerShell Script in Microsoft Intune.</figcaption>
</figure>

</p>
<div class="details admonition info open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg></span>Info<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">The PowerShell Script <a href="https://github.com/ennnbeee/oddsandendpoints-scripts/tree/main/Intune/PlatformScripts/PowerShell/CIS/L1" target="_blank" rel="noopener noreferrer">CIS (L1) System Services - Windows 11 Intune 3.0.1</a> is available to download and add as a new Platform Script to Microsoft Intune.</div></div></div>
<p>Now this is all well and good for disabling the services, <em>once</em>, but what happens if someone manages to enable them after the script has run, now what?</p>
<p>Well <a href="https://learn.microsoft.com/en-us/mem/intune/fundamentals/remediations" target="_blank" rel="noopener noreferrer">Remediations</a> that&rsquo;s what.</p>
<p>A quick modification to the existing script, to use some logic round how many of the services are not currently disabled, passing this back to Microsoft Intune as part of a detection script:</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) System Services - Windows 11 Intune 3.0.1_Detection.ps1</em></p>








  
  

  
    
  

  

  
  
  
  <div class="code-block highlight is-closed show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">PowerShell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-23" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="nv">$cisServices</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Browser&#39;</span><span class="p">,</span> <span class="c"># Computer Browser</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;IISADMIN&#39;</span><span class="p">,</span> <span class="c"># IIS Admin Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;irmon&#39;</span><span class="p">,</span> <span class="c"># Infrared monitor service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;SharedAccess&#39;</span><span class="p">,</span> <span class="c"># Internet Connection Sharing</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;LxssManager&#39;</span><span class="p">,</span> <span class="c"># LxssManager</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;FTPSVC&#39;</span><span class="p">,</span> <span class="c"># Microsoft FTP Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;sshd&#39;</span><span class="p">,</span> <span class="c"># OpenSSH SSH Server</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;RpcLocator&#39;</span><span class="p">,</span> <span class="c"># Remote Procedure Call (RPC) Locator</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;RemoteAccess&#39;</span><span class="p">,</span> <span class="c"># Routing and Remote Access</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;simptcp&#39;</span><span class="p">,</span> <span class="c"># Simple TCP/IP LocalServices$LocalServices</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;sacsvr&#39;</span><span class="p">,</span> <span class="c"># Special Administration Console Helper</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;SSDPSRV&#39;</span><span class="p">,</span> <span class="c"># SSDP Discovery</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;upnphost&#39;</span><span class="p">,</span> <span class="c"># UPnP Device Host</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;WMSvc&#39;</span><span class="p">,</span> <span class="c"># Web Management Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;WMPNetworkSvc&#39;</span><span class="p">,</span> <span class="c"># Windows Media Player Network Sharing Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;icssvc&#39;</span><span class="p">,</span> <span class="c"># Windows Mobile Hotspot Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;W3SVC&#39;</span><span class="p">,</span> <span class="c"># World Wide Web Publishing Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;XboxGipSvc&#39;</span><span class="p">,</span> <span class="c"># Xbox Accessory Management Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;XblAuthManager&#39;</span><span class="p">,</span> <span class="c"># Xbox Live Auth Manager</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;XblGameSave&#39;</span><span class="p">,</span> <span class="c"># Xbox Live Game Save</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;XboxNetApiSvc&#39;</span> <span class="c"># Xbox Live Networking Service</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Get current state on the services in the array above.</span>
</span></span><span class="line"><span class="cl"><span class="nv">$localServices</span> <span class="p">=</span> <span class="nb">Get-Service</span> <span class="n">-Name</span> <span class="nv">$cisServices</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl"><span class="nv">$notDisabled</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">foreach</span> <span class="p">(</span><span class="nv">$cisService</span> <span class="k">in</span> <span class="nv">$cisServices</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c"># Make sure service name in the list matches with local system services.</span>
</span></span><span class="line"><span class="cl">    <span class="c"># Added because of Computer Browser mismatch with &#34;bowser&#34; service</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$foundService</span> <span class="p">=</span> <span class="nv">$localServices</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="py">Name</span> <span class="o">-eq</span> <span class="nv">$cisService</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nv">$foundService</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$foundService</span><span class="p">.</span><span class="py">StartType</span> <span class="o">-ne</span> <span class="s1">&#39;Disabled&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nv">$notDisabled</span><span class="p">++</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nv">$notDisabled</span> <span class="o">-gt</span> <span class="mf">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Output</span> <span class="s2">&#34;Found </span><span class="nv">$notDisabled</span><span class="s2"> service(s) that should be disabled for CIS Level 1.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Exit</span> <span class="mf">1</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Output</span> <span class="s2">&#34;All required servicess are disabled for CIS Level 1.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Exit</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</div>



<p>Then a simple remediation script to loop through each service and disable it:</p>
<p><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M0 93.7l183.6-25.3v177.4H0V93.7zm0 324.6l183.6 25.3V268.4H0v149.9zm203.8 28L448 480V268.4H203.8v177.9zm0-380.6v180.1H448V32L203.8 65.7z"/></svg> <em>CIS (L1) System Services - Windows 11 Intune 3.0.1_Remediation.ps1</em></p>








  
  

  
    
  

  

  
  
  
  <div class="code-block highlight is-closed show-line-numbers  tw-group tw-my-2">
  <div class="
    code-block-title 
    
    tw-flex 
    tw-flex-row 
    tw-justify-between 
    tw-w-full tw-bg-bgColor-secondary
    ">      
    <button 
      class="
        tw-select-none 
        tw-mx-2 
        tw-block
        group-[.is-open]:tw-rotate-90
        tw-transition-[transform] 
        tw-duration-500 
        tw-ease-in-out
        print:!tw-hidden"
      disabled
      aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"/></svg></button>

    <div class="code-block-title-bar tw-w-full">
      <p class="tw-select-none !tw-my-1">PowerShell</p>
    </div>
    <div class="tw-flex">
      <button 
        class="
          line-number-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.show-line-numbers]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle line numbers"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M61.77 401l17.5-20.15a19.92 19.92 0 0 0 5.07-14.19v-3.31C84.34 356 80.5 352 73 352H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8h22.83a157.41 157.41 0 0 0-11 12.31l-5.61 7c-4 5.07-5.25 10.13-2.8 14.88l1.05 1.93c3 5.76 6.29 7.88 12.25 7.88h4.73c10.33 0 15.94 2.44 15.94 9.09 0 4.72-4.2 8.22-14.36 8.22a41.54 41.54 0 0 1-15.47-3.12c-6.49-3.88-11.74-3.5-15.6 3.12l-5.59 9.31c-3.72 6.13-3.19 11.72 2.63 15.94 7.71 4.69 20.38 9.44 37 9.44 34.16 0 48.5-22.75 48.5-44.12-.03-14.38-9.12-29.76-28.73-34.88zM496 224H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM16 160h64a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H64V40a8 8 0 0 0-8-8H32a8 8 0 0 0-7.14 4.42l-8 16A8 8 0 0 0 24 64h8v64H16a8 8 0 0 0-8 8v16a8 8 0 0 0 8 8zm-3.91 160H80a8 8 0 0 0 8-8v-16a8 8 0 0 0-8-8H41.32c3.29-10.29 48.34-18.68 48.34-56.44 0-29.06-25-39.56-44.47-39.56-21.36 0-33.8 10-40.46 18.75-4.37 5.59-3 10.84 2.8 15.37l8.58 6.88c5.61 4.56 11 2.47 16.12-2.44a13.44 13.44 0 0 1 9.46-3.84c3.33 0 9.28 1.56 9.28 8.75C51 248.19 0 257.31 0 304.59v4C0 316 5.08 320 12.09 320z"/></svg></button>

      <button 
        class="
          wrap-code-button
          tw-select-none 
          tw-mx-2 
          tw-hidden 
          group-[.is-open]:tw-block 
          group-[.is-wrap]:tw-text-fgColor-link 
          print:!tw-hidden" 
        title="Toggle code wrap"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg></button>
      
      <button 
        class="
          copy-code-button
          tw-select-none
          tw-mx-2 
          tw-hidden
          group-[.is-open]:tw-block
          hover:tw-text-fgColor-link 
          print:!tw-hidden"
        title="Copy code">
          <span class="copy-icon tw-block"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M433.941 65.941l-51.882-51.882A48 48 0 0 0 348.118 0H176c-26.51 0-48 21.49-48 48v48H48c-26.51 0-48 21.49-48 48v320c0 26.51 21.49 48 48 48h224c26.51 0 48-21.49 48-48v-48h80c26.51 0 48-21.49 48-48V99.882a48 48 0 0 0-14.059-33.941zM266 464H54a6 6 0 0 1-6-6V150a6 6 0 0 1 6-6h74v224c0 26.51 21.49 48 48 48h96v42a6 6 0 0 1-6 6zm128-96H182a6 6 0 0 1-6-6V54a6 6 0 0 1 6-6h106v88c0 13.255 10.745 24 24 24h88v202a6 6 0 0 1-6 6zm6-256h-64V48h9.632c1.591 0 3.117.632 4.243 1.757l48.368 48.368a6 6 0 0 1 1.757 4.243V112z"/></svg></span>
          <span class="check-icon tw-hidden"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"/></svg></span>
      </button>
        
      <button 
        class="
          tw-select-none 
          tw-mx-2 
          tw-block 
          group-[.is-open]:tw-hidden 
          print:!tw-hidden" 
        disabled
        aria-hidden="true"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"/></svg></button>
    </div>
  </div>
  <pre style="counter-reset: codeblock;" class="tw-block tw-m-0 tw-p-0"><code 
    id="codeblock-id-24" 
    class="
      chroma 
      !tw-block 
      tw-p-0
      tw-m-0
      tw-transition-[max-height] 
      tw-duration-500 
      tw-ease-in-out 
      group-[.is-closed]:!tw-max-h-0 
      group-[.is-wrap]:tw-text-wrap
      tw-overflow-y-hidden
      tw-overflow-x-auto
      tw-scrollbar-thin
      "><span class="line"><span class="cl"><span class="nv">$cisServices</span> <span class="p">=</span> <span class="vm">@</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;Browser&#39;</span><span class="p">,</span> <span class="c"># Computer Browser</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;IISADMIN&#39;</span><span class="p">,</span> <span class="c"># IIS Admin Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;irmon&#39;</span><span class="p">,</span> <span class="c"># Infrared monitor service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;SharedAccess&#39;</span><span class="p">,</span> <span class="c"># Internet Connection Sharing</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;LxssManager&#39;</span><span class="p">,</span> <span class="c"># LxssManager</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;FTPSVC&#39;</span><span class="p">,</span> <span class="c"># Microsoft FTP Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;sshd&#39;</span><span class="p">,</span> <span class="c"># OpenSSH SSH Server</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;RpcLocator&#39;</span><span class="p">,</span> <span class="c"># Remote Procedure Call (RPC) Locator</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;RemoteAccess&#39;</span><span class="p">,</span> <span class="c"># Routing and Remote Access</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;simptcp&#39;</span><span class="p">,</span> <span class="c"># Simple TCP/IP LocalServices$LocalServices</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;sacsvr&#39;</span><span class="p">,</span> <span class="c"># Special Administration Console Helper</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;SSDPSRV&#39;</span><span class="p">,</span> <span class="c"># SSDP Discovery</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;upnphost&#39;</span><span class="p">,</span> <span class="c"># UPnP Device Host</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;WMSvc&#39;</span><span class="p">,</span> <span class="c"># Web Management Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;WMPNetworkSvc&#39;</span><span class="p">,</span> <span class="c"># Windows Media Player Network Sharing Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;icssvc&#39;</span><span class="p">,</span> <span class="c"># Windows Mobile Hotspot Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;W3SVC&#39;</span><span class="p">,</span> <span class="c"># World Wide Web Publishing Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;XboxGipSvc&#39;</span><span class="p">,</span> <span class="c"># Xbox Accessory Management Service</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;XblAuthManager&#39;</span><span class="p">,</span> <span class="c"># Xbox Live Auth Manager</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;XblGameSave&#39;</span><span class="p">,</span> <span class="c"># Xbox Live Game Save</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;XboxNetApiSvc&#39;</span> <span class="c"># Xbox Live Networking Service</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Get current state on the services in the array above.</span>
</span></span><span class="line"><span class="cl"><span class="nv">$localServices</span> <span class="p">=</span> <span class="nb">Get-Service</span> <span class="n">-Name</span> <span class="nv">$cisServices</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl"><span class="nv">$notDisabled</span> <span class="p">=</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$service</span> <span class="k">in</span> <span class="nv">$cisServices</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c"># Make sure service name in the list matches with local system services.</span>
</span></span><span class="line"><span class="cl">        <span class="c"># Added because of Computer Browser mismatch with &#34;bowser&#34; service</span>
</span></span><span class="line"><span class="cl">        <span class="nv">$foundService</span> <span class="p">=</span> <span class="nv">$localServices</span> <span class="p">|</span> <span class="nb">Where-Object</span> <span class="p">{</span> <span class="nv">$_</span><span class="p">.</span><span class="py">Name</span> <span class="o">-eq</span> <span class="nv">$service</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nv">$foundService</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nv">$foundService</span><span class="p">.</span><span class="py">StartType</span> <span class="o">-ne</span> <span class="s1">&#39;Disabled&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nv">$notDisabled</span><span class="p">++</span>
</span></span><span class="line"><span class="cl">                <span class="nb">Set-Service</span> <span class="nv">$FoundService</span><span class="p">.</span><span class="py">Name</span> <span class="n">-StartupType</span> <span class="n">Disabled</span> <span class="n">-Force</span> <span class="n">-ErrorAction</span> <span class="n">SilentlyContinue</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Output</span> <span class="s2">&#34;Found </span><span class="nv">$notDisabled</span><span class="s2"> service(s) that are now disabled.&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Exit</span> <span class="mf">0</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">catch</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Write-Output</span> <span class="s2">&#34;Unable to disable </span><span class="nv">$notDisabled</span><span class="s2"> service(s).&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Exit</span> <span class="mf">2000</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre>
</div>



<p>Deployed using Microsoft Intune to your devices:</p>
<p><figure><a class="lightgallery" href="/posts/windows-cis-patching-gaps-part3/img/cis-l1remediation.png" title="CIS Level 1 System Services Remediation" data-thumbnail="/posts/windows-cis-patching-gaps-part3/img/cis-l1remediation.png" data-sub-html="<h2>CIS Level 1 services remediation in Microsoft Intune.</h2><p>CIS Level 1 System Services Remediation</p>"><img  loading="lazy" src=/posts/windows-cis-patching-gaps-part3/img/cis-l1remediation.png   alt="CIS Level 1 System Services Remediation" height="727" width="1036"></a><figcaption class="image-caption">CIS Level 1 services remediation in Microsoft Intune.</figcaption>
</figure>

</p>
<p>Ensuring you set a suitable schedule for the remediation to run, daily is probably overkill, just make sure it&rsquo;s running before any kind of CIS audit 😂.</p>
<div class="details admonition info open">
    <div class="details-summary admonition-title">
        <span class="icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"/></svg></span>Info<span class="details-icon"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></span>
    </div>
    <div class="details-content">
        <div class="admonition-content">The <a href="https://github.com/ennnbeee/oddsandendpoints-scripts/tree/main/Intune/Remediation/CIS/L1" target="_blank" rel="noopener noreferrer">CIS (L1) System Services - Windows 11 Intune 3.0.1</a> detection and remediation scripts are available for your to add into your Microsoft Intune tenant.</div></div></div>
<h2 id="summary" class="headerLink">
    <a href="#summary" class="header-mark"></a>3 Summary</h2><p>What I&rsquo;ve learnt looking over the CIS Level 1 settings, is that there are some pretty large gaps in the build kit; settings that just don&rsquo;t exist such as with Windows LAPS, settings that only apply to users and not devices, settings that only apply to specific editions of Windows, minimum settings that will cause unexpected behaviour, and some normal good practice settings for security solutions such as Windows Defender that are just plain missing.</p>
<p>This does mean though, that applying a CIS benchmark is only <em>part</em> of the story when it comes to securing your Windows 11 cloud native devices, and it&rsquo;s worth looking into other <a href="https://learn.microsoft.com/en-us/mem/intune/protect/security-baselines" target="_blank" rel="noopener noreferrer">Security Baselines</a> (cough Microsoft cough) to help harden not only the operating system, but applications that reside on top.</p>
<p>Next up is the final part in the series, the dreaded CIS Level 2 settings, surely it can&rsquo;t get any worse?</p>
</div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 15 July 2024</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line print:!tw-hidden">
            <div class="post-info-md"></div>
            <div class="post-info-share"><button title="Share on Facebook" data-sharer="facebook" data-url="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/" data-hashtag="intune"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg></button><button title="Share on Linkedin" data-sharer="linkedin" data-url="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg></button><button title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/" data-title="Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows 11" data-web><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg></button><button title="Share on Reddit" data-sharer="reddit" data-url="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg></button><button title="Share on Skype" data-sharer="skype" data-url="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/" data-title="Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows 11"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M424.7 299.8c2.9-14 4.7-28.9 4.7-43.8 0-113.5-91.9-205.3-205.3-205.3-14.9 0-29.7 1.7-43.8 4.7C161.3 40.7 137.7 32 112 32 50.2 32 0 82.2 0 144c0 25.7 8.7 49.3 23.3 68.2-2.9 14-4.7 28.9-4.7 43.8 0 113.5 91.9 205.3 205.3 205.3 14.9 0 29.7-1.7 43.8-4.7 19 14.6 42.6 23.3 68.2 23.3 61.8 0 112-50.2 112-112 .1-25.6-8.6-49.2-23.2-68.1zm-194.6 91.5c-65.6 0-120.5-29.2-120.5-65 0-16 9-30.6 29.5-30.6 31.2 0 34.1 44.9 88.1 44.9 25.7 0 42.3-11.4 42.3-26.3 0-18.7-16-21.6-42-28-62.5-15.4-117.8-22-117.8-87.2 0-59.2 58.6-81.1 109.1-81.1 55.1 0 110.8 21.9 110.8 55.4 0 16.9-11.4 31.8-30.3 31.8-28.3 0-29.2-33.5-75-33.5-25.7 0-42 7-42 22.5 0 19.8 20.8 21.8 69.1 33 41.4 9.3 90.7 26.8 90.7 77.6 0 59.1-57.1 86.5-112 86.5z"/></svg></button><button title="Share on Telegram" data-sharer="telegram" data-url="https://www.oddsandendpoints.co.uk/posts/windows-cis-patching-gaps-part3/" data-title="Patching Gaps in the CIS Windows 11 Benchmark - Level 1 Windows 11" data-web><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M446.7 98.6l-67.6 318.8c-5.1 22.5-18.4 28.1-37.3 17.5l-103-75.9-49.7 47.8c-5.5 5.5-10.1 10.1-20.7 10.1l7.4-104.9 190.9-172.5c8.3-7.4-1.8-11.5-12.9-4.1L117.8 284 16.2 252.2c-22.1-6.9-22.5-22.1 4.6-32.7L418.2 66.4c18.4-6.9 34.5 4.1 28.5 32.2z"/></svg></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"/></svg>&nbsp;<a href="/tags/intune/">Intune</a>,&nbsp;<a href="/tags/security/">Security</a>,&nbsp;<a href="/tags/cis/">Center for Internet Security (CIS)</a>,&nbsp;<a href="/tags/endpoint-security/">Endpoint Security</a>,&nbsp;<a href="/tags/remediation/">Remediation Scripts</a>,&nbsp;<a href="/tags/powershell/">PowerShell</a>,&nbsp;<a href="/tags/settings-catalog/">Settings Catalog</a>,&nbsp;<a href="/tags/custom-profiles/">Custom Profiles</a></section>
        <section class="print:!tw-hidden">
            <span><button class="tw-text-fgColor-link-muted hover:tw-text-fgColor-link-muted-hover" onclick="window.history.back();">Back</button></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav print:tw-hidden"><a href="/posts/windows-autopilot-v2-renaming/" class="prev" rel="prev" title="Renaming Windows Autopilot v2 Devices"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"/></svg>Renaming Windows Autopilot v2 Devices</a>
            <a href="/posts/firewall-rule-policy-conversion/" class="next" rel="next" title="Microsoft Intune and the Curious Case of the Converting Firewall Rule Policy">Microsoft Intune and the Curious Case of the Converting Firewall Rule Policy<svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"/></svg></a></div>
</div>
<div id="comments" class="print:!tw-hidden tw-pt-32 tw-pb-8"><div id="giscus"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://giscus.app/">giscus</a>.
            </noscript></div></article></main><footer class="footer">
        <div class="footer-container"><div class="footer-line">
                    Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreferrer" title="Hugo 0.141.0">Hugo</a>&nbsp;|&nbsp;Theme - <a href="https://github.com/HEIGE-PCloud/DoIt" target="_blank" rel="noopener noreferrer" title="DoIt 0.4.0"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M402.3 344.9l32-32c5-5 13.7-1.5 13.7 5.7V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h273.5c7.1 0 10.7 8.6 5.7 13.7l-32 32c-1.5 1.5-3.5 2.3-5.7 2.3H48v352h352V350.5c0-2.1.8-4.1 2.3-5.6zm156.6-201.8L296.3 405.7l-90.4 10c-26.2 2.9-48.5-19.2-45.6-45.6l10-90.4L432.9 17.1c22.9-22.9 59.9-22.9 82.7 0l43.2 43.2c22.9 22.9 22.9 60 .1 82.8zM460.1 174L402 115.9 216.2 301.8l-7.3 65.3 65.3-7.3L460.1 174zm64.8-79.7l-43.2-43.2c-4.1-4.1-10.8-4.1-14.8 0L436 82l58.1 58.1 30.9-30.9c4-4.2 4-10.8-.1-14.9z"/></svg> DoIt</a>
                </div><div class="footer-line"><svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 448c-110.532 0-200-89.451-200-200 0-110.531 89.451-200 200-200 110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200zm107.351-101.064c-9.614 9.712-45.53 41.396-104.065 41.396-82.43 0-140.484-61.425-140.484-141.567 0-79.152 60.275-139.401 139.762-139.401 55.531 0 88.738 26.62 97.593 34.779a11.965 11.965 0 0 1 1.936 15.322l-18.155 28.113c-3.841 5.95-11.966 7.282-17.499 2.921-8.595-6.776-31.814-22.538-61.708-22.538-48.303 0-77.916 35.33-77.916 80.082 0 41.589 26.888 83.692 78.277 83.692 32.657 0 56.843-19.039 65.726-27.225 5.27-4.857 13.596-4.039 17.82 1.738l19.865 27.17a11.947 11.947 0 0 1-1.152 15.518z"/></svg>2022 - 2025<span class="author">&nbsp;<a href="https://www.linkedin.com/in/ennnbeee/" target="_blank" rel="noopener noreferrer">Nick Benton</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer><div class="print:!tw-hidden tw-flex tw-flex-col tw-fixed tw-right-4 tw-bottom-4 tw-gap-2"><a href="#back-to-top" id="back-to-top-button" class="tw-transition-opacity tw-opacity-0 tw-block tw-bg-bgColor-secondary tw-rounded-full" style="padding: 0.6rem; line-height: 1.3rem; font-size: 1rem;" title="Back to Top">
      <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg>
  </a>

  <button id="toc-drawer-button" class="tw-block tw-bg-bgColor-secondary tw-rounded-full md:tw-hidden" style="padding: 0.6rem; line-height: 1.3rem; font-size: 1rem;">
      <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"/></svg>
  </button><a href="#comments" id="view-comments" class="tw-block tw-bg-bgColor-secondary tw-rounded-full" style="padding: 0.6rem; line-height: 1.3rem; font-size: 1rem;" title="View Comments">
      <svg class="icon"
    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) --><path d="M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"/></svg>
  </a></div>
<script type="module">
        (async () => {
            const supportSpeculationRules = HTMLScriptElement.supports && HTMLScriptElement.supports("speculationrules");
            if (!supportSpeculationRules) {
              await import("\/lib\/instant.page\/instantpage.min.js");
            }
        })();
    </script><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="/lib/lightgallery/lightgallery.min.css">
        <noscript><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"></noscript>
<script>window.config={"autocomplete.min.js":"/lib/autocomplete/autocomplete.min.js","comment":{"giscus":{"darkTheme":"dark","dataCategory":"Comments","dataCategoryId":"DIC_kwDOLUU7Ls4CdUYI","dataEmitMetadata":"0","dataInputPosition":"top","dataLang":"en","dataLoading":"lazy","dataMapping":"title","dataReactionsEnabled":"0","dataRepo":"ennnbeee/oddsandendpoints-web","dataRepoId":"R_kgDOLUU7Lg","dataStrict":"0","lightTheme":"light"}},"fuse.min.js":"/lib/fuse/fuse.min.js","lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"distance":100,"findAllMatches":false,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":false,"ignoreLocation":false,"isCaseSensitive":false,"location":0,"maxResultLength":10,"minMatchCharLength":2,"noResultsFound":"No results found","snippetLength":40,"threshold":0.6,"type":"fuse","useExtendedSearch":true},"sharerjs":true};</script><script
    src="/lib/lightgallery/lightgallery.min.js"
    
      defer
    
  ></script><script
    src="/lib/lightgallery/lg-thumbnail.min.js"
    
      defer
    
  ></script><script
    src="/lib/lightgallery/lg-zoom.min.js"
    
      defer
    
  ></script><script
    src="/lib/sharer/sharer.min.js"
    
  ></script><script
    src="/js/theme.min.js"
    
      defer
    
  ></script><script
    src="/js/giscus.min.js"
    
      defer
    
  ></script><script type="text/javascript">
            window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());
            gtag('config', 'G-EM0CM5PL0C', { 'anonymize_ip': true });
        </script><script
    src="https://www.googletagmanager.com/gtag/js?id=G-EM0CM5PL0C"
    async
  ></script>

<script type="speculationrules">
  {
    "prerender": [
      {
        "where": { "href_matches": "/*" },
        "eagerness": "moderate"
      }
    ]
  }
</script>
</body>

</html>
