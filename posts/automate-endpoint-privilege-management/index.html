<!doctype html><html lang=en dir=ltr class=scroll-smooth data-default-appearance=dark data-auto-appearance=true><head><meta charset=utf-8><meta http-equiv=content-language content="en"><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><title>Automating Endpoint Privilege Management Policies with PowerShell &#183; MEM v ENNBEE - Battles with Modern Device Management</title>
<meta name=title content="Automating Endpoint Privilege Management Policies with PowerShell &#183; MEM v ENNBEE - Battles with Modern Device Management"><meta name=description content="Creation of Microsoft Intune Suite license Endpoint Privilege Management rules based on audit of Windows devices using PowerShell and Graph API."><meta name=keywords content="security,settingscatalog,epm,graph,powershell,"><meta name=robots content="all"><link rel=canonical href=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/><link type=text/css rel=stylesheet href=/css/main.bundle.min.62d9e5a4f72e5f18879bb14f9133e9ea237bac445ad34d52e00a607d4f0f21f262f9ca0602d4b2ac00591796aa6431ba47959508cb56df52b2f49e433cc165a3.css integrity="sha512-YtnlpPcuXxiHm7FPkTPp6iN7rERa001S4ApgfU8PIfJi+coGAtSyrABZF5aqZDG6R5WVCMtW31Ky9J5DPMFlow=="><script type=text/javascript src=/js/appearance.min.94423161281b8fd1ac69e1efd2cdbbd6c0ab06d7e5e3bc444b9784e8c3050834518955d2a9ce0479ece7055f350b513d5facc34cbb9fb4ad4d02c7733ba643c1.js integrity="sha512-lEIxYSgbj9GsaeHv0s271sCrBtfl47xES5eE6MMFCDRRiVXSqc4EeeznBV81C1E9X6zDTLuftK1NAsdzO6ZDwQ=="></script><script defer type=text/javascript id=script-bundle src=/js/main.bundle.min.d6c35110b5d7df8014403fbb81cd21a9d89daf9eb586c936e585e9d04adc204dce554aa737f81e8c902b9dea9e67bd63a977b77dedefb8a39430581ebc519207.js integrity="sha512-1sNRELXX34AUQD+7gc0hqdidr561hsk25YXp0ErcIE3OVUqnN/gejJArneqeZ71jqXe3fe3vuKOUMFgevFGSBw==" data-copy data-copied></script><script src=/js/zoom.min.js></script><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=google-site-verification content="ma5La6cWDE6YXvljJ7w3991FminUAxur2sqavzMSnpU"><meta property="og:url" content="https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/"><meta property="og:site_name" content="MEM v ENNBEE - Battles with Modern Device Management"><meta property="og:title" content="Automating Endpoint Privilege Management Policies with PowerShell"><meta property="og:description" content="Creation of Microsoft Intune Suite license Endpoint Privilege Management rules based on audit of Windows devices using PowerShell and Graph API."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-06-01T18:58:40+01:00"><meta property="article:modified_time" content="2023-06-01T18:58:40+01:00"><meta property="article:tag" content="Security"><meta property="article:tag" content="Settings Catalog"><meta property="article:tag" content="Endpoint Privilege Management"><meta property="article:tag" content="Graph API"><meta property="article:tag" content="PowerShell"><meta property="og:image" content="https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/featured.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/featured.png"><meta name=twitter:title content="Automating Endpoint Privilege Management Policies with PowerShell"><meta name=twitter:description content="Creation of Microsoft Intune Suite license Endpoint Privilege Management rules based on audit of Windows devices using PowerShell and Graph API."><script type=application/ld+json>[{"@context":"https://schema.org","@type":"Article","articleSection":"Posts","name":"Automating Endpoint Privilege Management Policies with PowerShell","headline":"Automating Endpoint Privilege Management Policies with PowerShell","description":"Creation of Microsoft Intune Suite license Endpoint Privilege Management rules based on audit of Windows devices using PowerShell and Graph API.","abstract":"So you’re interested in Endpoint Privilege Management in Microsoft Intune and in you’re excitement you’ve gone and deployed a new policy to audit using the Reporting Scope options, all elevations across your managed Windows 10 and later devices. Now what?","inLanguage":"en","url":"https:\/\/memv.ennbee.uk\/posts\/automate-endpoint-privilege-management\/","author":{"@type":"Person","name":" "},"copyrightYear":"2023","dateCreated":"2023-06-01T18:58:40\u002b01:00","datePublished":"2023-06-01T18:58:40\u002b01:00","dateModified":"2023-06-01T18:58:40\u002b01:00","keywords":["security","settingscatalog","epm","graph","powershell"],"mainEntityOfPage":"true","wordCount":"3573"}]</script><meta name=author content=" "><link href=https://learn.microsoft.com/en-us/users/ennnbeee/credentials rel=me><link href=https://github.com/ennnbeee rel=me><link href=https://www.linkedin.com/in/ennnbeee/ rel=me><link href=https://twitter.com/ennnbee rel=me><link href=https://www.youtube.com/@ennnbeee rel=me><script src=/lib/jquery/jquery.slim.min.js integrity></script><meta name=theme-color><script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js></script><script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js></script><script src=https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js></script><script>const firebaseConfig={apiKey:"AIzaSyCdoYM2WvSY3kvcPgdeh-VO-SzEMUZwYjY",authDomain:"AIzaSyCdoYM2WvSY3kvcPgdeh-VO-SzEMUZwYjY",projectId:"memvennbee",storageBucket:"memvennbee.appspot.com",messagingSenderId:"395697438623",appId:"1:395697438623:web:ce5d7d42dea8e265b947aa",measurementId:"G-EM0CM5PL0C"};var app=firebase.initializeApp(firebaseConfig),db=firebase.firestore(),auth=firebase.auth()</script></head><script>localStorage.getItem("doNotTrack")===null&&localStorage.setItem("doNotTrack","1");var doNotTrack=localStorage.getItem("doNotTrack")</script><div id=cookie-notice><span>We use necessary cookies to make the site work. We'd like to set additional cookies to understand site usage and make site improvements.</span>
<a id=cookie-notice-accept class="btn btn-primary btn-sm">Accept Cookies</a>
<a id=cookie-notice-deny class="btn btn-primary btn-sm">Reject Cookies</a>
<a href=/privacy/ class="btn btn-primary btn-sm">Show Cookie Purposes</a></div><script>function createCookie(e,t,n){var s,o="";n&&(s=new Date,s.setTime(s.getTime()+n*24*60*60*1e3),o="; expires="+s.toUTCString()),document.cookie=e+"="+t+o+"; path=/"}function readCookie(e){for(var t,s=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(t=o[n];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(s)==0)return t.substring(s.length,t.length)}return null}function eraseCookie(e){createCookie(e,"",-1)}readCookie("cookie-notice-option")=="true"?localStorage.setItem("doNotTrack","0"):readCookie("cookie-notice-option")!="false"&&(document.getElementById("cookie-notice").style.display="block"),document.getElementById("cookie-notice-accept").addEventListener("click",function(){createCookie("cookie-notice-option","true",31),document.getElementById("cookie-notice").style.display="none",location.reload()}),document.getElementById("cookie-notice-deny").addEventListener("click",function(){createCookie("cookie-notice-option","false",31),document.getElementById("cookie-notice").style.display="none",location.reload()})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-EM0CM5PL0C"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-EM0CM5PL0C")</script><body class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"><div id=the-top class="absolute flex self-center"><a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600" href=#main-content><span class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a></div><div class=min-h-[148px]></div><div class="fixed inset-x-0 pl-[24px] pr-[24px] bg-neutral dark:bg-neutral-800" style=z-index:100><div class="relative max-w-[64rem] ml-auto mr-auto"><div style=padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3"><div><a href=/ class=flex><span class=sr-only>MEM v ENNBEE - Battles with Modern Device Management</span>
<img src=/img/logo_dk.png width=1150 height=450 class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="MEM v ENNBEE - Battles with Modern Device Management"></a></div><div class="flex flex-1 items-center justify-between"><nav class="flex space-x-3"><a href=/ class="text-base font-medium text-gray-500 hover:text-gray-900">MEM v ENNBEE - Battles with Modern Device Management</a></nav><nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12"><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>Posts</p></a><div><div class="cursor-pointer flex items-center nested-menu"><a class="text-base font-medium text-gray-500 hover:text-primary-600 dark:hover:text-primary-400" title>Topics
</a><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></div><div class="absolute menuhide"><div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl"><div class="flex flex-col space-y-3"><a href=/categories/intune/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title>Intune</p></a><a href=/categories/configmgr/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title>ConfigMgr</p></a><a href=/categories/windows/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title>Windows</p></a><a href=/categories/macos/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title>macOS</p></a><a href=/categories/android/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title>Android</p></a><a href=/categories/ios/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-sm" title>iOS/iPadOS</p></a></div></div></div></div><a href=/about/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-base font-medium" title>About</p></a><a href=https://github.com/ennnbeee/mve-scripts/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></span><p class="text-base font-medium" title></p></a><a href=https://www.buymeacoffee.com/ennnbeee target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M88 0C74.7.0 64 10.7 64 24c0 38.9 23.4 59.4 39.1 73.1l1.1 1C120.5 112.3 128 119.9 128 136c0 13.3 10.7 24 24 24s24-10.7 24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C119.5 47.7 112 40.1 112 24c0-13.3-10.7-24-24-24zM32 192c-17.7.0-32 14.3-32 32V416c0 53 43 96 96 96H288c53 0 96-43 96-96h16c61.9.0 112-50.1 112-112s-50.1-112-112-112H352 32zm352 64h16c26.5.0 48 21.5 48 48s-21.5 48-48 48H384V256zM224 24c0-13.3-10.7-24-24-24s-24 10.7-24 24c0 38.9 23.4 59.4 39.1 73.1l1.1 1C232.5 112.3 240 119.9 240 136c0 13.3 10.7 24 24 24s24-10.7 24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C231.5 47.7 224 40.1 224 24z"/></svg></span></span><p class="text-base font-medium" title></p></a><button id=search-button aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></button><div class="ltr:mr-14 rtl:ml-14 flex items-center"><button id=appearance-switcher aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400"><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></nav><div class="flex md:hidden items-center space-x-5 md:ml-12 h-12"><span></span>
<button id=search-button-mobile aria-label=Search class="text-base hover:text-primary-600 dark:hover:text-primary-400" title>
<span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>
</span></button>
<button id=appearance-switcher-mobile aria-label="Dark mode switcher" type=button class="text-base hover:text-primary-600 dark:hover:text-primary-400" style=margin-right:5px><div class="flex items-center justify-center dark:hidden"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M32 256C32 132.2 132.3 32 255.8 32c11.36.0 29.7 1.668 40.9 3.746 9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3 9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480 132.1 480 32 379.6 32 256z"/></svg></span></div><div class="items-center justify-center hidden dark:flex"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 159.1c-53.02.0-95.1 42.98-95.1 95.1s41.2 96.9 95.1 96.9 95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347l-63.2-91.9 63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89 164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6 12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256 2.74 347.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7 19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109 109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69.0-127.1-57.31-127.1-127.1.0-70.69 57.31-127.1 127.1-127.1S383.1 186.2 383.1 256c0 70.7-56.4 127.1-127.1 127.1z"/></svg></span></div></button></div></div><div class="-my-2 -mr-2 md:hidden"><label id=menu-button for=menu-controller class=block><input type=checkbox id=menu-controller class=hidden><div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 96C0 78.33 14.33 64 32 64H416c17.7.0 32 14.33 32 32 0 17.7-14.3 32-32 32H32C14.33 128 0 113.7.0 96zM0 256c0-17.7 14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32H32c-17.67.0-32-14.3-32-32zM416 448H32c-17.67.0-32-14.3-32-32s14.33-32 32-32H416c17.7.0 32 14.3 32 32s-14.3 32-32 32z"/></svg></span></div><div id=menu-wrapper style=padding-top:5px class="fixed inset-0 z-30 invisible w-screen h-screen m-0 overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50"><ul class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl"><li><span class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></span></li><li class=mt-1><a href=/posts/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Posts</p></a></li><li class=mt-1><a class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>Topics</p><span><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75.0 011.06.02L10 11.168l3.71-3.938a.75.75.0 111.08 1.04l-4.25 4.5a.75.75.0 01-1.08.0l-4.25-4.5a.75.75.0 01.02-1.06z" clip-rule="evenodd"/></svg></span></span></a></li><li class=mt-1><a href=/categories/intune/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title>Intune</p></a></li><li class=mt-1><a href=/categories/configmgr/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title>ConfigMgr</p></a></li><li class=mt-1><a href=/categories/windows/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title>Windows</p></a></li><li class=mt-1><a href=/categories/macos/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title>macOS</p></a></li><li class=mt-1><a href=/categories/android/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title>Android</p></a></li><li class=mt-1><a href=/categories/ios/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-sm font-small" title>iOS/iPadOS</p></a></li><li class=mb-2></li><li class=mt-1><a href=/about/ class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><p class="text-bg font-bg" title>About</p></a></li><li class=mt-1><a href=https://github.com/ennnbeee/mve-scripts/ target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li><li class=mt-1><a href=https://www.buymeacoffee.com/ennnbeee target=_blank class="flex items-center text-gray-500 hover:text-primary-600 dark:hover:text-primary-400"><div><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M88 0C74.7.0 64 10.7 64 24c0 38.9 23.4 59.4 39.1 73.1l1.1 1C120.5 112.3 128 119.9 128 136c0 13.3 10.7 24 24 24s24-10.7 24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C119.5 47.7 112 40.1 112 24c0-13.3-10.7-24-24-24zM32 192c-17.7.0-32 14.3-32 32V416c0 53 43 96 96 96H288c53 0 96-43 96-96h16c61.9.0 112-50.1 112-112s-50.1-112-112-112H352 32zm352 64h16c26.5.0 48 21.5 48 48s-21.5 48-48 48H384V256zM224 24c0-13.3-10.7-24-24-24s-24 10.7-24 24c0 38.9 23.4 59.4 39.1 73.1l1.1 1C232.5 112.3 240 119.9 240 136c0 13.3 10.7 24 24 24s24-10.7 24-24c0-38.9-23.4-59.4-39.1-73.1l-1.1-1C231.5 47.7 224 40.1 224 24z"/></svg></span></div><p class="text-bg font-bg" title></p></a></li></ul></div></label></div></div><script>(function(){var e=$(".main-menu"),t=window.location.pathname;e.find('a[href="'+t+'"]').each(function(e,t){$(t).children("p").addClass("active")})})()</script></div></div><div class="relative flex flex-col grow"><main id=main-content class=grow><article><div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom" style=background-image:url(/posts/automate-endpoint-privilege-management/featured.png)><div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal"></div><div class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal"></div></div><div id=background-blur class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div><script>window.addEventListener("scroll",function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,n=document.getElementById("background-blur");n.style.opacity=t/300})</script><header id=single_header class="mt-5 max-w-prose"><h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">Automating Endpoint Privilege Management Policies with PowerShell</h1><div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden"><div class="flex flex-row flex-wrap items-center"><time datetime="2023-06-01 18:58:40 +0100 +0100">1 June 2023</time><span class="px-2 text-primary-500">&#183;</span><span>
<span id=views_posts/Automate-Endpoint-Privilege-Management/index.md class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400" title=views>loading</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg>
</span></span></span><span class="px-2 text-primary-500">&#183;</span>
<script type=text/javascript src=/js/zen-mode.min.ccc8b2a0c4505216444ca25530c7328aa0bef94f43dabaf3e598e1b4271de9eec76c1cb35917471a4f7ccb8d84051b3acef42baa30724ac3a667fcf1fec4432a.js integrity="sha512-zMiyoMRQUhZETKJVMMcyiqC++U9D2rrz5ZjhtCcd6e7HbByzWRdHGk98y42EBRs6zvQrqjBySsOmZ/zx/sRDKg=="></script><span class=mb-[2px]><span id=zen-mode-button class="text-lg hover:text-primary-500" title="Enable zen mode" data-title-i18n-disable="Enable zen mode" data-title-i18n-enable="Disable zen mode"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50" width="50" height="50"><path fill="currentcolor" d="M12.980469 4C9.1204688 4 5.9804688 7.14 5.9804688 11L6 26H9.9804688V11c0-1.65 1.3400002-3 3.0000002-3H40.019531c1.66.0 3 1.35 3 3V39c0 1.65-1.34 3-3 3H29c0 1.54-.579062 2.94-1.539062 4H40.019531c3.86.0 7-3.14 7-7V11c0-3.86-3.14-7-7-7H12.980469zM7 28c-2.206.0-4 1.794-4 4V42c0 2.206 1.794 4 4 4H23c2.206.0 4-1.794 4-4V32c0-2.206-1.794-4-4-4H7zm0 4H23L23.001953 42H7V32z"/></svg></span></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/intune/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Microsoft Intune
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/windows/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Windows 10 and later
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/security/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Security
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/settingscatalog/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Settings Catalog
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/epm/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Endpoint Privilege Management
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/graph/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Graph API
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/powershell/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">PowerShell</span></span></span></div></div><div class="flex author author-extra mt-4"><img class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4" width=96 height=96 src=/img/ennbee_hu99d519a7f6a8c26797bef1a11e6d7187_254551_192x192_fill_box_center_3.png><div class=place-self-center><div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">Author</div><a href=https://memv.ennbee.uk//authors/ennbee class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">Nick Benton</a><div class="text-sm text-neutral-700 dark:text-neutral-400">Principal Cloud Endpoint Consultant | Intune Blogger</div><div class="text-2xl sm:text-lg"><div class="flex flex-wrap text-neutral-400 dark:text-neutral-500"><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://github.com/ennnbeee target=_blank aria-label=Github rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.linkedin.com/in/ennnbeee/ target=_blank aria-label=Linkedin rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://learn.microsoft.com/en-us/users/ennnbeee/credentials target=_blank aria-label=Microsoft rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M0 32h214.6v214.6H0V32zm233.4.0H448v214.6H233.4V32zM0 265.4h214.6V480H0V265.4zm233.4.0H448V480H233.4V265.4z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://twitter.com/ennnbee target=_blank aria-label=Twitter rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645.0 138.72-105.583 298.558-298.558 298.558-59.452.0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055.0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421.0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391.0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04.0-57.828 46.782-104.934 104.934-104.934 30.213.0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.youtube.com/@ennnbeee target=_blank aria-label=Youtube rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78.0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
</span></span></a><a class="px-1 hover:text-primary-700 dark:hover:text-primary-400" href=https://www.credly.com/users/ennnbeee target=_blank aria-label=Graduation-Cap rel="me noopener noreferrer"><span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentcolor" d="M320 32c-8.1.0-16.1 1.4-23.7 4.1L15.8 137.4C6.3 140.9.0 149.9.0 160s6.3 19.1 15.8 22.6l57.9 20.9C57.3 229.3 48 259.8 48 291.9V320c0 28.4-10.8 57.7-22.3 80.8-6.5 13-13.9 25.8-22.5 37.6C0 442.7-.9 448.3.9 453.4s6 8.9 11.2 10.2l64 16c4.2 1.1 8.7.3 12.4-2s6.3-6.1 7.1-10.4c8.6-42.8 4.3-81.2-2.1-108.7-3.2-14.2-7.5-28.7-13.5-42V291.9c0-30.2 10.2-58.7 27.9-81.5 12.9-15.5 29.6-28 49.2-35.7l157-61.7c8.2-3.2 17.5.8 20.7 9s-.8 17.5-9 20.7l-157 61.7c-12.4 4.9-23.3 12.4-32.2 21.6l159.6 57.6c7.6 2.7 15.6 4.1 23.7 4.1s16.1-1.4 23.7-4.1l280.6-101c9.5-3.4 15.8-12.5 15.8-22.6s-6.3-19.1-15.8-22.6L343.7 36.1C336.1 33.4 328.1 32 320 32zM128 408c0 35.3 86 72 192 72s192-36.7 192-72L496.7 262.6 354.5 314c-11.1 4-22.8 6-34.5 6s-23.5-2-34.5-6L143.3 262.6 128 408z"/></svg></span></span></a></div></div></div></div><div class=mb-5></div></header><section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row"><div class="order-first lg:ml-auto px-0 lg:order-last ltr:lg:pl-8 rtl:lg:pr-8"><div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky lg:top-[140px]"><details open class="toc-right mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block"><summary class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#epm-reporting>EPM Reporting</a><ul><li><a href=#getting-report-data>Getting Report Data</a></li><li><a href=#exporting-report-data>Exporting Report Data</a></li></ul></li><li><a href=#epm-policies>EPM Policies</a><ul><li><a href=#importing-rule-data>Importing Rule Data</a></li><li><a href=#grouping-epm-rules>Grouping EPM Rules</a></li></ul></li><li><a href=#creating-settings-catalog-policies>Creating Settings Catalog Policies</a><ul><li><a href=#policy-start-json>Policy Start JSON</a></li><li><a href=#policy-end-json>Policy End JSON</a></li></ul></li><li><a href=#creating-the-initial-rule>Creating the Initial Rule</a><ul><li><a href=#initial-rule-start-json>Initial Rule Start JSON</a></li><li><a href=#initial-rule-elevation-json>Initial Rule Elevation JSON</a><ul><li><a href=#initial-rule-elevation-automatic>Initial Rule Elevation Automatic</a></li><li><a href=#initial-rule-elevation-user-authentication>Initial Rule Elevation User Authentication</a></li><li><a href=#initial-rule-elevation-user-business-justification>Initial Rule Elevation User Business Justification</a></li></ul></li><li><a href=#initial-rule-end-json>Initial Rule End JSON</a></li></ul></li><li><a href=#creating-subsequent-rules>Creating Subsequent Rules</a><ul><li><a href=#rule-start-json>Rule Start JSON</a></li><li><a href=#rule-elevation-json>Rule Elevation JSON</a><ul><li><a href=#rule-elevation-automatic>Rule Elevation Automatic</a></li><li><a href=#rule-elevation-user-authentication>Rule Elevation User Authentication</a></li><li><a href=#rule-elevation-user-business-justification>Rule Elevation User Business Justification</a></li></ul></li><li><a href=#rule-end-json>Rule End JSON</a></li><li><a href=#rule-ending-json>Rule Ending JSON</a></li></ul></li><li><a href=#submitting-epm-policies>Submitting EPM Policies</a><ul><li><a href=#final-policy-json>Final Policy JSON</a></li><li><a href=#pushing-to-graph-api>Pushing to Graph API</a></li><li><a href=#assigning-epm-policies>Assigning EPM Policies</a></li></ul></li><li><a href=#epm-policy-deployment>EPM Policy Deployment</a><ul><li><a href=#report-mode>Report Mode</a></li><li><a href=#create-mode>Create Mode</a></li><li><a href=#create-and-assign-mode>Create and Assign Mode</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></details><details class="toc-inside mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden"><summary class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">Table of Contents</summary><div class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600"><nav id=TableOfContents><ul><li><a href=#epm-reporting>EPM Reporting</a><ul><li><a href=#getting-report-data>Getting Report Data</a></li><li><a href=#exporting-report-data>Exporting Report Data</a></li></ul></li><li><a href=#epm-policies>EPM Policies</a><ul><li><a href=#importing-rule-data>Importing Rule Data</a></li><li><a href=#grouping-epm-rules>Grouping EPM Rules</a></li></ul></li><li><a href=#creating-settings-catalog-policies>Creating Settings Catalog Policies</a><ul><li><a href=#policy-start-json>Policy Start JSON</a></li><li><a href=#policy-end-json>Policy End JSON</a></li></ul></li><li><a href=#creating-the-initial-rule>Creating the Initial Rule</a><ul><li><a href=#initial-rule-start-json>Initial Rule Start JSON</a></li><li><a href=#initial-rule-elevation-json>Initial Rule Elevation JSON</a><ul><li><a href=#initial-rule-elevation-automatic>Initial Rule Elevation Automatic</a></li><li><a href=#initial-rule-elevation-user-authentication>Initial Rule Elevation User Authentication</a></li><li><a href=#initial-rule-elevation-user-business-justification>Initial Rule Elevation User Business Justification</a></li></ul></li><li><a href=#initial-rule-end-json>Initial Rule End JSON</a></li></ul></li><li><a href=#creating-subsequent-rules>Creating Subsequent Rules</a><ul><li><a href=#rule-start-json>Rule Start JSON</a></li><li><a href=#rule-elevation-json>Rule Elevation JSON</a><ul><li><a href=#rule-elevation-automatic>Rule Elevation Automatic</a></li><li><a href=#rule-elevation-user-authentication>Rule Elevation User Authentication</a></li><li><a href=#rule-elevation-user-business-justification>Rule Elevation User Business Justification</a></li></ul></li><li><a href=#rule-end-json>Rule End JSON</a></li><li><a href=#rule-ending-json>Rule Ending JSON</a></li></ul></li><li><a href=#submitting-epm-policies>Submitting EPM Policies</a><ul><li><a href=#final-policy-json>Final Policy JSON</a></li><li><a href=#pushing-to-graph-api>Pushing to Graph API</a></li><li><a href=#assigning-epm-policies>Assigning EPM Policies</a></li></ul></li><li><a href=#epm-policy-deployment>EPM Policy Deployment</a><ul><li><a href=#report-mode>Report Mode</a></li><li><a href=#create-mode>Create Mode</a></li><li><a href=#create-and-assign-mode>Create and Assign Mode</a></li></ul></li><li><a href=#summary>Summary</a></li></ul></nav></div></details><script>(function(){var t,e=$("#TableOfContents");if(e.length>0){t=$(window);function n(){var s,o=t.scrollTop(),i=$(".anchor"),n="";if(i.each(function(e,t){t=$(t),t.offset().top-$(window).height()/3<=o&&(n=decodeURIComponent(t.attr("id")))}),s=e.find("a.active"),s.length==1&&s.eq(0).attr("href")=="#"+n)return!0;s.each(function(e,t){$(t).removeClass("active").siblings("ul").hide()}),e.find('a[href="#'+n+'"]').addClass("active"),e.find('a[href="#'+n+'"]').parentsUntil("#TableOfContents").each(function(e,t){$(t).children("a").parents("ul").show()})}t.on("scroll",n),$(document).ready(function(){e.find("a").parent("li").find("ul").hide(),n()})}})()</script></div></div><div class="min-w-0 min-h-0 max-w-fit"><div class="article-content max-w-prose mb-20"><p>So you&rsquo;re interested in <a href=https://learn.microsoft.com/en-us/mem/intune/protect/epm-overview target=_blank>Endpoint Privilege Management</a> in Microsoft Intune, you&rsquo;ve found, begged for, borrowed or stolen the money for shiny new <a href=https://learn.microsoft.com/en-us/mem/intune/protect/epm-overview#licensing target=_blank>Intune Suite or EPM licenses</a>, and in you&rsquo;re excitement you&rsquo;ve gone and deployed a new policy to audit using the <a href=https://learn.microsoft.com/en-us/mem/intune/protect/epm-policies#about-windows-elevation-settings-policy target=_blank>Reporting Scope</a> options, all elevations across your managed Windows 10 and later devices. Now what?</p><p>Well it&rsquo;s policy creation time, but that seems like a labour intensive (well many clicks) task, and as much as the <a href=https://learn.microsoft.com/en-us/mem/intune/protect/epm-reports target=_blank>reports</a> give you all the required information you need to review unmanaged elevations and create new policies and elevation rules, there has to be a better way to take the data in the report and create these policies and subsequent rules for you.</p><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 512 512"><path fill="currentcolor" d="M441 58.9 453.1 71c9.4 9.4 9.4 24.6.0 33.9L424 134.1 377.9 88 407 58.9c9.4-9.4 24.6-9.4 33.9.0zM209.8 256.2 344 121.9 390.1 168 255.8 302.2c-2.9 2.9-6.5 5-10.4 6.1L186.9 325l16.7-58.5c1.1-3.9 3.2-7.5 6.1-10.4zM373.1 25 175.8 222.2c-8.7 8.7-15 19.4-18.3 31.1l-28.6 1e2c-2.4 8.4-.1 17.4 6.1 23.6s15.2 8.5 23.6 6.1l1e2-28.6c11.8-3.4 22.5-9.7 31.1-18.3L487 138.9c28.1-28.1 28.1-73.7.0-101.8L474.9 25C446.8-3.1 401.2-3.1 373.1 25zM88 64C39.4 64 0 103.4.0 152V424c0 48.6 39.4 88 88 88H360c48.6.0 88-39.4 88-88V312c0-13.3-10.7-24-24-24s-24 10.7-24 24V424c0 22.1-17.9 40-40 40H88c-22.1.0-40-17.9-40-40V152c0-22.1 17.9-40 40-40H2e2c13.3.0 24-10.7 24-24s-10.7-24-24-24H88z"/></svg>
</span></span><span class=dark:text-neutral-300>The functions, authentication, and script have now been updated to support the use of the Graph PowerShell SDK.</span></div><h2 class="relative group">EPM Reporting<div id=epm-reporting class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#epm-reporting aria-label=Anchor>#</a></span></h2><p>The Endpoint elevation report in Microsoft Intune will give us the data we need to create <a href=https://learn.microsoft.com/en-us/mem/intune/protect/epm-policies#about-windows-elevation-rules-policy target=_blank>hash based</a> rules, so let&rsquo;s find a way to get the report data and export it with some collated information to make reviewing the elevations a little easier, as no one wants to review individual elevations from each user on a case by case basis, unless you&rsquo;re in InfoSec.</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/img/epm-report_hu0389a9dc7f505e4283b1236886bb7510_80298_filter_7979971555928466975.webp#left alt="Elevation Report"><figcaption>Screenshot of Microsoft Intune Elevation Report.</figcaption></figure></p><h3 class="relative group">Getting Report Data<div id=getting-report-data class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#getting-report-data aria-label=Anchor>#</a></span></h3><p>Once connected to Graph API using <code>Connect-MgGraph</code> we can use the <code>deviceManagement/privilegeManagementElevations</code> endpoint (of which there is no documentation currently, tut tut Microsoft) to pull back the report data. I&rsquo;ve given the option to pull back Managed, Unmanaged, and All elevation types with this function so it&rsquo;s at least reusable, though for now we only care about the Unmanaged elevations.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=kd>Function</span><span class=w> </span><span class=nb>Get-DeviceEPMReport</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>cmdletbinding</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>param</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>
</span></span><span class="line hl"><span class=cl>        <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>Mandatory</span> <span class=p>=</span> <span class=vm>$false</span><span class=p>)]</span>
</span></span><span class="line hl"><span class=cl>        <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;Managed&#39;</span><span class=p>,</span> <span class=s1>&#39;Unmanaged&#39;</span><span class=p>)]</span>
</span></span><span class="line hl"><span class=cl>        <span class=p>[</span><span class=no>String</span><span class=p>]</span><span class=nv>$Elevation</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nb>Parameter</span><span class=p>(</span><span class=na>Mandatory</span> <span class=p>=</span> <span class=vm>$false</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=nv>$Top</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$graphApiVersion</span> <span class=p>=</span> <span class=s1>&#39;beta&#39;</span>
</span></span><span class="line hl"><span class=cl>    <span class=nv>$Resource</span> <span class=p>=</span> <span class=s1>&#39;deviceManagement/privilegeManagementElevations&#39;</span>
</span></span><span class="line hl"><span class=cl>
</span></span><span class="line hl"><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$Elevation</span> <span class=o>-eq</span> <span class=s1>&#39;Managed&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$uri</span> <span class=p>=</span> <span class=s2>&#34;https://graph.microsoft.com/</span><span class=nv>$graphApiVersion</span><span class=s2>/</span><span class=p>$(</span><span class=nv>$Resource</span><span class=p>)</span><span class=s2>?filter=(elevationType ne &#39;unmanagedElevation&#39;)&#34;</span>
</span></span><span class="line hl"><span class=cl>            <span class=p>(</span><span class=nb>Invoke-MgGraphRequest</span> <span class=n>-Uri</span> <span class=nv>$uri</span> <span class=n>-Method</span> <span class=n>Get</span><span class=p>).</span><span class=py>value</span>
</span></span><span class="line hl"><span class=cl>        <span class=p>}</span>
</span></span><span class="line hl"><span class=cl>        <span class=k>elseif</span> <span class=p>(</span><span class=nv>$Elevation</span> <span class=o>-eq</span> <span class=s1>&#39;Unmanaged&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$uri</span> <span class=p>=</span> <span class=s2>&#34;https://graph.microsoft.com/</span><span class=nv>$graphApiVersion</span><span class=s2>/</span><span class=p>$(</span><span class=nv>$Resource</span><span class=p>)</span><span class=s2>?filter=(elevationType eq &#39;unmanagedElevation&#39;)&#34;</span>
</span></span><span class="line hl"><span class=cl>            <span class=p>(</span><span class=nb>Invoke-MgGraphRequest</span> <span class=n>-Uri</span> <span class=nv>$uri</span> <span class=n>-Method</span> <span class=n>Get</span><span class=p>).</span><span class=py>value</span>
</span></span><span class="line hl"><span class=cl>        <span class=p>}</span>
</span></span><span class="line hl"><span class=cl>        <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$uri</span> <span class=p>=</span> <span class=s2>&#34;https://graph.microsoft.com/</span><span class=nv>$graphApiVersion</span><span class=s2>/</span><span class=p>$(</span><span class=nv>$Resource</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=nb>Invoke-MgGraphRequest</span> <span class=n>-Uri</span> <span class=nv>$uri</span> <span class=n>-Method</span> <span class=n>Get</span><span class=p>).</span><span class=py>value</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Error</span> <span class=nv>$Error</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=py>ErrorDetails</span><span class=p>.</span><span class=py>Message</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Running the PowerShell function will give us an output of each Unmanaged elevation, which we can then process, apply some groupings, and eventually export.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nb>Get-DeviceEPMReport</span> <span class=n>-Elevation</span> <span class=n>Unmanaged</span>
</span></span></code></pre></div><p><figure><img class="my-0 rounded-md" loading=lazy src=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/img/epm-get_hua53b07ded52a72085460e7c619eeb254_18586_filter_15446094843505520898.webp#left alt="Elevation Report"><figcaption>Screenshot PowerShell script elevation report output.</figcaption></figure></p><h3 class="relative group">Exporting Report Data<div id=exporting-report-data class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#exporting-report-data aria-label=Anchor>#</a></span></h3><p>Now that we have the data from the elevation report, I thought it best we group the elevations by hash value, as this is a unique identifier for each application that has been elevated by a user, as well as counting the number of elevations for that application, the users who have elevated, and the devices they have elevated from.</p><p>The above information, and below details required for rule creation, allows us to review the elevations and whether we want to create rules from them:</p><ul><li><strong>Count of Elevations for the application</strong>: so we can see whether this is a widely used elevated application</li><li><strong>Elevated application file name</strong>: required for rule creation</li><li><strong>Elevated application internal name</strong></li><li><strong>Elevated application publisher</strong></li><li><strong>Elevated application product name</strong></li><li><strong>Elevated application description</strong></li><li><strong>Elevated application file path</strong>: formatted with <code>\\</code> as is required by the rule creation</li><li><strong>Elevated application file version</strong></li><li><strong>Users who have elevated the application</strong>: formatted for only unique users so we can assess which users are elevating the application</li><li><strong>Devices where the application has been elevated</strong>: formatted for only unique devices so we can assess from which devices the application is being elevated</li></ul><p>The below PowerShell captures all the required data in the correct formats to a new <code>$Report</code> array variable, which we can then export to CSV once we&rsquo;ve cycled through all elevations.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$Report</span> <span class=p>=</span> <span class=vm>@</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=nv>$Hashes</span> <span class=p>=</span> <span class=nb>Get-DeviceEPMReport</span> <span class=n>-Elevation</span> <span class=n>Unmanaged</span> <span class=p>|</span> <span class=nb>Group-Object</span> <span class=n>-Property</span> <span class=n>hash</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$Hash</span> <span class=k>in</span> <span class=nv>$Hashes</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$Elevations</span> <span class=p>=</span> <span class=nv>$Hash</span><span class=p>.</span><span class=nb>Group
</span></span></span><span class=line><span class=cl><span class=nb></span>    <span class=nv>$Users</span> <span class=p>=</span> <span class=vm>@</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Devices</span> <span class=p>=</span> <span class=vm>@</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$Elevation</span> <span class=k>in</span> <span class=nv>$Elevations</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$FileName</span> <span class=p>=</span> <span class=nv>$Elevation</span><span class=p>.</span><span class=py>filePath</span> <span class=p>|</span> <span class=nb>Split-Path</span> <span class=n>-Leaf</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$FileInternalName</span> <span class=p>=</span> <span class=nv>$Elevation</span><span class=p>.</span><span class=py>internalName</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$FileCompany</span> <span class=p>=</span> <span class=nv>$Elevation</span><span class=p>.</span><span class=py>companyName</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$FileProduct</span> <span class=p>=</span> <span class=nv>$Elevation</span><span class=p>.</span><span class=py>productName</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$FileDescription</span> <span class=p>=</span> <span class=nv>$Elevation</span><span class=p>.</span><span class=py>fileDescription</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$FilePath</span> <span class=p>=</span> <span class=p>(</span><span class=nv>$Elevation</span><span class=p>.</span><span class=py>filePath</span> <span class=p>|</span> <span class=nb>Split-Path</span><span class=p>)</span> <span class=o>-replace</span> <span class=s1>&#39;\\&#39;</span><span class=p>,</span> <span class=s1>&#39;\\&#39;</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$FileVersion</span> <span class=p>=</span> <span class=nv>$Elevation</span><span class=p>.</span><span class=py>fileVersion</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$Users</span> <span class=p>+=</span> <span class=nv>$Elevation</span><span class=p>.</span><span class=py>upn</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$Devices</span> <span class=p>+=</span> <span class=nv>$Elevation</span><span class=p>.</span><span class=py>deviceName</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$Data</span> <span class=p>=</span> <span class=p>[</span><span class=no>PSCustomObject</span><span class=p>]</span><span class=vm>@</span><span class=p>{</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>ElevationCount</span>   <span class=p>=</span> <span class=nv>$Hash</span><span class=p>.</span><span class=py>Count</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>Product</span>          <span class=p>=</span> <span class=nv>$FileProduct</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>Description</span>      <span class=p>=</span> <span class=nv>$FileDescription</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>Publisher</span>        <span class=p>=</span> <span class=nv>$FileCompany</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>FileName</span>         <span class=p>=</span> <span class=nv>$FileName</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>FileInternalName</span> <span class=p>=</span> <span class=nv>$FileInternalName</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>FileVersion</span>      <span class=p>=</span> <span class=nv>$FileVersion</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>FilePath</span>         <span class=p>=</span> <span class=nv>$FilePath</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>FileHash</span>         <span class=p>=</span> <span class=nv>$Hash</span><span class=p>.</span><span class=py>Name</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>Users</span>            <span class=p>=</span> <span class=p>((</span><span class=nv>$Users</span> <span class=p>|</span> <span class=nb>Get-Unique</span><span class=p>)</span> <span class=n>-join</span> <span class=s1>&#39; &#39;</span> <span class=p>|</span> <span class=nb>Out-String</span><span class=p>).</span><span class=py>Trim</span><span class=p>()</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>Devices</span>          <span class=p>=</span> <span class=p>((</span><span class=nv>$Devices</span> <span class=p>|</span> <span class=nb>Get-Unique</span><span class=p>)</span> <span class=n>-join</span> <span class=s1>&#39; &#39;</span> <span class=p>|</span> <span class=nb>Out-String</span><span class=p>).</span><span class=py>Trim</span><span class=p>()</span>
</span></span><span class="line hl"><span class=cl>        <span class=n>ElevationType</span>    <span class=p>=</span> <span class=s1>&#39;Automatic/UserAuthentication/UserJustification&#39;</span>
</span></span><span class="line hl"><span class=cl>        <span class=nb>Group </span>           <span class=p>=</span> <span class=s1>&#39;GroupName&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$Report</span> <span class=p>+=</span> <span class=nv>$Data</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Exporting the <code>$Report</code> variable to CSV using the append function for each elevation, we get something like the below.</p><pre tabindex=0><code class=language-csv data-lang=csv>&#34;ElevationCount&#34;,&#34;Product&#34;,&#34;Description&#34;,&#34;Publisher&#34;,&#34;FileName&#34;,&#34;FileInternalName&#34;,&#34;FileVersion&#34;,&#34;FilePath&#34;,&#34;FileHash&#34;,&#34;Users&#34;,&#34;Devices&#34;,&#34;ElevationType&#34;,&#34;Group&#34;
&#34;6&#34;,&#34;Microsoft® Windows® Operating System&#34;,&#34;Windows PowerShell&#34;,&#34;Microsoft Corporation&#34;,&#34;powershell.exe&#34;,&#34;POWERSHELL&#34;,&#34;10.0.19041.2913&#34;,&#34;C:\\Windows\\System32\\WindowsPowerShell\\v1.0&#34;,&#34;B4E7BC24BF3F5C3DA2EB6E9EC5EC10F90099DEFA91B820F2F3FC70DD9E4785C4&#34;,&#34;AzureAD\AlexWilber AzureAD\ChristieCline&#34;,&#34;DESKTOP-DL6CCRJ DESKTOP-7KFLL12&#34;,&#34;Automatic/UserAuthentication/UserJustification&#34;,&#34;GroupName&#34;
&#34;4&#34;,&#34;PaladinVPN&#34;,&#34;PaladinVPN&#34;,&#34;Ledger Media Ltd&#34;,&#34;PaladinVPN.exe&#34;,&#34;PaladinVPN.exe&#34;,&#34;2.1.3.102&#34;,&#34;C:\\Program Files (x86)\\PaladinVPN&#34;,&#34;B6EF395DE2F28162DBAFCA79BAABEBB211245A68425CE096402030417FEA1160&#34;,&#34;AzureAD\AlexWilber&#34;,&#34;DESKTOP-DL6CCRJ&#34;,&#34;Automatic/UserAuthentication/UserJustification&#34;,&#34;GroupName&#34;
&#34;12&#34;,&#34;Microsoft® Windows® Operating System&#34;,&#34;Windows Command Processor&#34;,&#34;Microsoft Corporation&#34;,&#34;cmd.exe&#34;,&#34;cmd&#34;,&#34;10.0.19041.746&#34;,&#34;C:\\Windows\\system32&#34;,&#34;B99D61D874728EDC0918CA0EB10EAB93D381E7367E377406E65963366C874450&#34;,&#34;AzureAD\AlexWilber AzureAD\ChristieCline&#34;,&#34;DESKTOP-DL6CCRJ DESKTOP-7KFLL12&#34;,&#34;Automatic/UserAuthentication/UserJustification&#34;,&#34;GroupName&#34;
</code></pre><p>Now we have something to review, with two additional fields of <code>ElevationType</code> and <code>Group</code> that we will use for creation of new EPM policies and rules later on, forward planning here.</p><h2 class="relative group">EPM Policies<div id=epm-policies class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#epm-policies aria-label=Anchor>#</a></span></h2><p>I have no shame when I say that I started from <a href=https://andrewstaylor.com/2023/03/27/adding-endpoint-privilege-management-rules-via-powershell/ target=_blank>Andrew Taylor&rsquo;s</a> script to create EPM rules using PowerShell, allowing the creation of new EPM Policies and associated rules in Microsoft Intune based on a local files on the machine the script is being executed from. For me what this was missing was the ability to create multiple rules per EPM policy, and the to not rely on the file being local to the machine running the script to capture the required rule data.</p><h3 class="relative group">Importing Rule Data<div id=importing-rule-data class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#importing-rule-data aria-label=Anchor>#</a></span></h3><p>With the CSV report exported, we now need to update the file itself, removing entries where we don&rsquo;t want to create rules, and updating those we do want to create with both the <code>ElevationType</code> and <code>Group</code> for each rule we want to create. The <code>ElevationType</code> field needs to be populated with one of the below entries based on the approval type to be used:</p><ul><li><strong>Automatic</strong>: elevation happens invisibly to the user. There&rsquo;s no prompt, and no indication that the file is running in an elevated context.</li><li><strong>UserAuthentication</strong>: A user confirmed elevation always requires the user to click on a confirmation prompt to run the file requiring users to authenticate using their organization credentials.</li><li><strong>UserJustification</strong>: A user confirmed elevation always requires the user to click on a confirmation prompt to run the file requiring the user to enter a business justification.</li></ul><p>The <code>group</code> field is there to not only reference which Azure Active Directory or synchronised Active Directory group the rule will apply to, but will allow for grouping of rules into a single policy, as this just makes sense as we&rsquo;ll be applying the policy to the same group.</p><h3 class="relative group">Grouping EPM Rules<div id=grouping-epm-rules class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#grouping-epm-rules aria-label=Anchor>#</a></span></h3><p>As we want to create a single policy for each provided group, containing all applicable rules, we need to capture the data based on the assignment group, this can be done pretty easily using the <code>Group-Object</code> command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$Policies</span> <span class=p>=</span> <span class=nb>Import-Csv</span> <span class=n>-Path</span> <span class=nv>$ImportPath</span> <span class=p>|</span> <span class=nb>Group-Object</span> <span class=n>-Property</span> <span class=nb>Group
</span></span></span></code></pre></div><p>Now we can check if the supplied group exists, using the below function to search for the group based on it&rsquo;s name.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=kd>Function</span><span class=w> </span><span class=nb>Get-IntuneGroup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>cmdletbinding</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>param</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Mandatory</span> <span class=p>=</span> <span class=vm>$true</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$graphApiVersion</span> <span class=p>=</span> <span class=s1>&#39;beta&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Resource</span> <span class=p>=</span> <span class=s1>&#39;groups&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>        <span class=nv>$authToken</span><span class=p>[</span><span class=s1>&#39;ConsistencyLevel&#39;</span><span class=p>]</span> <span class=p>=</span> <span class=s1>&#39;eventual&#39;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$searchterm</span> <span class=p>=</span> <span class=s1>&#39;search=&#34;displayName:&#39;</span> <span class=p>+</span> <span class=nv>$Name</span> <span class=p>+</span> <span class=s1>&#39;&#34;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$uri</span> <span class=p>=</span> <span class=s2>&#34;https://graph.microsoft.com/</span><span class=nv>$graphApiVersion</span><span class=s2>/</span><span class=nv>$Resource</span><span class=s2>`?</span><span class=nv>$searchterm</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>(</span><span class=nb>Invoke-MgGraphRequest</span> <span class=n>-Uri</span> <span class=nv>$uri</span> <span class=n>-Method</span> <span class=n>Get</span><span class=p>).</span><span class=py>Value</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Error</span> <span class=nv>$Error</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=py>ErrorDetails</span><span class=p>.</span><span class=py>Message</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900"><span class="text-primary-400 ltr:pr-3 rtl:pl-3 flex items-center"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M256 0C114.6.0.0 114.6.0 256s114.6 256 256 256 256-114.6 256-256S397.4.0 256 0zm0 128c17.67.0 32 14.33 32 32 0 17.67-14.33 32-32 32s-32-14.3-32-32 14.3-32 32-32zm40 256h-80c-13.2.0-24-10.7-24-24s10.75-24 24-24h16v-64h-8c-13.25.0-24-10.75-24-24s10.8-24 24-24h32c13.25.0 24 10.75 24 24v88h16c13.25.0 24 10.75 24 24s-10.7 24-24 24z"/></svg>
</span></span><span class=dark:text-neutral-300>Take note of the change to the <code>$authtoken</code> variable which needs updating to include &lsquo;ConsistencyLevel&rsquo; to support <a href=https://devblogs.microsoft.com/microsoft365dev/microsoft-graph-advanced-queries-for-directory-objects-are-now-generally-available/ target=_blank>advanced queries</a> using Graph API.</span></div><p>We can ensure that the group exists prior to deploying the EPM policies to Microsoft Intune, and set the variables for each new rule to be created based on the data in the CSV file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$Policy</span> <span class=k>in</span> <span class=nv>$Policies</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Group</span> <span class=p>=</span> <span class=nb>Get-IntuneGroup</span> <span class=n>-Name</span> <span class=nv>$Policy</span><span class=p>.</span><span class=py>Name</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=vm>$null</span> <span class=o>-eq</span> <span class=nv>$Group</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Output</span> <span class=s2>&#34;</span><span class=p>$(</span><span class=nv>$Policy</span><span class=p>.</span><span class=n>Name</span><span class=p>)</span><span class=s2> group does not exist, unable to create EPM Policy&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$Rules</span> <span class=p>=</span> <span class=nv>$Policy</span><span class=p>.</span><span class=nb>Group
</span></span></span><span class=line><span class=cl><span class=nb></span>        <span class=nv>$JSONRules</span> <span class=p>=</span> <span class=vm>@</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$Rule</span> <span class=k>in</span> <span class=nv>$Rules</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$FileName</span> <span class=p>=</span> <span class=nv>$Rule</span><span class=p>.</span><span class=py>FileName</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$FileInternalName</span> <span class=p>=</span> <span class=nv>$Rule</span><span class=p>.</span><span class=py>FileInternalName</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$FilePath</span> <span class=p>=</span> <span class=nv>$Rule</span><span class=p>.</span><span class=py>FilePath</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$FileHash</span> <span class=p>=</span> <span class=nv>$Rule</span><span class=p>.</span><span class=py>FileHash</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$ElevationType</span> <span class=p>=</span> <span class=nv>$Rule</span><span class=p>.</span><span class=py>ElevationType</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$FileProduct</span> <span class=p>=</span> <span class=nv>$Rule</span><span class=p>.</span><span class=py>Product</span> <span class=o>-replace</span> <span class=s1>&#39;[^\x30-\x39\x41-\x5A\x61-\x7A]+&#39;</span><span class=p>,</span> <span class=s1>&#39; &#39;</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$FileDescription</span> <span class=p>=</span> <span class=nv>$Rule</span><span class=p>.</span><span class=py>Description</span>
</span></span><span class="line hl"><span class=cl>            <span class=nv>$RuleDescription</span> <span class=p>=</span> <span class=vm>$</span><span class=p>(</span><span class=nv>$Rule</span><span class=p>.</span><span class=py>Publisher</span> <span class=p>+</span> <span class=s1>&#39; &#39;</span> <span class=p>+</span> <span class=nv>$Rule</span><span class=p>.</span><span class=n>Description</span><span class=p>)</span> <span class=o>-replace</span> <span class=s1>&#39;[^\x30-\x39\x41-\x5A\x61-\x7A]+&#39;</span><span class=p>,</span> <span class=s1>&#39; &#39;</span>
</span></span></code></pre></div><p>Now onto the fun that is EPM policy and rule creation.</p><h2 class="relative group">Creating Settings Catalog Policies<div id=creating-settings-catalog-policies class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#creating-settings-catalog-policies aria-label=Anchor>#</a></span></h2><p>The EPM Policies sit within the Setting Catalog space in Microsoft Intune, and it&rsquo;s no secret that creating new Settings Catalog policies in Microsoft Intune is no walk in the park as per this post from <a href=https://powers-hell.com/2021/03/08/working-with-intune-settings-catalog-using-powershell-and-graph/ target=_blank>Powers Hell</a>. Our issue, in addition to Settings Catalogs creation being a pain in the arse, is that we want to create multiple rules in one EPM policy which comes with it&rsquo;s own headache.</p><p>Using <a href=https://github.com/andrew-s-taylor/public/blob/main/Powershell%20Scripts/Intune/add-epmfilerule.ps1 target=_blank>add-epmfilerule.ps1</a> and exports of EPM policies using <a href=https://github.com/microsoftgraph/powershell-intune-samples/blob/master/SettingsCatalog/SettingsCatalog_Export.ps1 target=_blank>Intune PowerShell Samples</a> as a basis for the JSON structure, we can build the policy with multuple rules in stages with separate sections for the policy and rules.</p><h3 class="relative group">Policy Start JSON<div id=policy-start-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#policy-start-json aria-label=Anchor>#</a></span></h3><p>Easy one to start with as this section will be the same for each policy created, passing in variables from the imported CSV report.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONPolicyStart</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class="line hl"><span class=cl><span class=sh>        &#34;description&#34;: &#34;EPM Policy for </span><span class=p>$(</span><span class=nv>$Group</span><span class=p>.</span><span class=n>displayName</span><span class=p>)</span><span class=sh>&#34;,
</span></span></span><span class="line hl"><span class=cl><span class=sh>        &#34;name&#34;: &#34;EPM Policy for </span><span class=p>$(</span><span class=nv>$Group</span><span class=p>.</span><span class=n>displayName</span><span class=p>)</span><span class=sh>&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;platforms&#34;: &#34;windows10&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settings&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>            {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingInstance&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationGroupSettingCollectionInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;settingInstanceTemplateId&#34;: &#34;ee3d2e5f-6b3d-4cb1-af9b-37b02d3dbae2&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                    },
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;groupSettingCollectionValue&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h3 class="relative group">Policy End JSON<div id=policy-end-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#policy-end-json aria-label=Anchor>#</a></span></h3><p>This finishes off the JSON file needed to submit to Graph API, again this will be the same for each EPM policy.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONPolicyEnd</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                        ]
</span></span></span><span class=line><span class=cl><span class=sh>                    }
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            ],
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;technologies&#34;: &#34;endpointPrivilegeManagement&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;templateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;templateId&#34;: &#34;cff02aad-51b1-498d-83ad-81161a393f56_1&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    }
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><p>That&rsquo;s the simple part done, now to get our head around the rules.</p><h2 class="relative group">Creating the Initial Rule<div id=creating-the-initial-rule class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#creating-the-initial-rule aria-label=Anchor>#</a></span></h2><p>The first rule in an EPM policy has differing JSON formatting than any subsequent rules, requiring <code>settingValueTemplateId</code> values. We&rsquo;ll use logic in the PowerShell script to identify whether the each rule is the first in the list by querying the array of rules to check if the rule being processed is the first.</p><h3 class="relative group">Initial Rule Start JSON<div id=initial-rule-start-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#initial-rule-start-json aria-label=Anchor>#</a></span></h3><p>The variables we created, and populated by the CSV file, are added to the JSON for the following values:</p><ul><li>Rule Description</li><li>Application Product Name</li><li>Application Internal Name</li><li>File Hash</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleStart</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;children&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>            {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_appliesto&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingInstanceTemplateId&#34;: &#34;0cde1c42-c701-44b1-94b7-438dd4536128&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                },
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;choiceSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_allusers&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;settingValueTemplateId&#34;: &#34;2ec26569-c08f-434c-af3d-a50ac4a1ce26&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;useTemplateDefault&#34;: false
</span></span></span><span class=line><span class=cl><span class=sh>                        },
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;children&#34;: []
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            },
</span></span></span><span class=line><span class=cl><span class=sh>            {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_description&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingInstanceTemplateId&#34;: &#34;b3714f3a-ead8-4682-a16f-ffa264c9d58f&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                },
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class="line hl"><span class=cl><span class=sh>                    &#34;value&#34;: &#34;</span><span class=nv>$RuleDescription</span><span class=sh>&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;settingValueTemplateId&#34;: &#34;5e82a1e9-ef4f-43ea-8031-93aace2ad14d&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;useTemplateDefault&#34;: false
</span></span></span><span class=line><span class=cl><span class=sh>                    }
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            },
</span></span></span><span class=line><span class=cl><span class=sh>            {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_productname&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingInstanceTemplateId&#34;: &#34;234631a1-aeb1-436f-9e05-dcd9489caf08&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                },
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class="line hl"><span class=cl><span class=sh>                    &#34;value&#34;: &#34;</span><span class=nv>$FileProduct</span><span class=sh>&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;settingValueTemplateId&#34;: &#34;e466f96d-0633-40b3-86a4-9e093b696077&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;useTemplateDefault&#34;: false
</span></span></span><span class=line><span class=cl><span class=sh>                    }
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            },
</span></span></span><span class=line><span class=cl><span class=sh>            {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_internalname&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingInstanceTemplateId&#34;: &#34;08511f12-25b5-4218-812c-39a2db444ef1&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                },
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class="line hl"><span class=cl><span class=sh>                    &#34;value&#34;: &#34;</span><span class=nv>$FileInternalName</span><span class=sh>&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;settingValueTemplateId&#34;: &#34;ec295dd4-6bbc-4fa8-a503-960784c53f41&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;useTemplateDefault&#34;: false
</span></span></span><span class=line><span class=cl><span class=sh>                    }
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            },
</span></span></span><span class=line><span class=cl><span class=sh>            {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_filehash&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingInstanceTemplateId&#34;: &#34;e4436e2c-1584-4fba-8e38-78737cbbbfdf&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                },
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class="line hl"><span class=cl><span class=sh>                    &#34;value&#34;: &#34;</span><span class=nv>$FileHash</span><span class=sh>&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;settingValueTemplateId&#34;: &#34;1adcc6f7-9fa4-4ce3-8941-2ce22cf5e404&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                        &#34;useTemplateDefault&#34;: false
</span></span></span><span class=line><span class=cl><span class=sh>                    }
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            },
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h3 class="relative group">Initial Rule Elevation JSON<div id=initial-rule-elevation-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#initial-rule-elevation-json aria-label=Anchor>#</a></span></h3><p>Based on the updated <code>$ElevationType</code> variable in the CSV file, we can define which of the below three elevation type JSON formats are passed into the policy JSON.</p><h4 class="relative group">Initial Rule Elevation Automatic<div id=initial-rule-elevation-automatic class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#initial-rule-elevation-automatic aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleElev</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;choiceSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;children&#34;: [],
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateId&#34;: &#34;cb2ea689-ebc3-42ea-a7a4-c704bb13e3ad&#34;
</span></span></span><span class=line><span class=cl><span class=sh>            },
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_automatic&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateId&#34;: &#34;bc5a31ac-95b5-4ec6-be1f-50a384bb165f&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h4 class="relative group">Initial Rule Elevation User Authentication<div id=initial-rule-elevation-user-authentication class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#initial-rule-elevation-user-authentication aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleElev</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;choiceSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;children&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>                {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingCollectionInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;choiceSettingCollectionValue&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>                        {
</span></span></span><span class=line><span class=cl><span class=sh>                            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                            &#34;children&#34;: [],
</span></span></span><span class="line hl"><span class=cl><span class=sh>                            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype_validation_1&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                        }
</span></span></span><span class=line><span class=cl><span class=sh>                    ],
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype_validation&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            ],
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateId&#34;: &#34;cb2ea689-ebc3-42ea-a7a4-c704bb13e3ad&#34;
</span></span></span><span class=line><span class=cl><span class=sh>            },
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_self&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateId&#34;: &#34;bc5a31ac-95b5-4ec6-be1f-50a384bb165f&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h4 class="relative group">Initial Rule Elevation User Business Justification<div id=initial-rule-elevation-user-business-justification class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#initial-rule-elevation-user-business-justification aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleElev</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;choiceSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;children&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>                {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingCollectionInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;choiceSettingCollectionValue&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>                        {
</span></span></span><span class=line><span class=cl><span class=sh>                            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                            &#34;children&#34;: [],
</span></span></span><span class="line hl"><span class=cl><span class=sh>                            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype_validation_0&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                        }
</span></span></span><span class=line><span class=cl><span class=sh>                    ],
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype_validation&#34;
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            ],
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateId&#34;: &#34;cb2ea689-ebc3-42ea-a7a4-c704bb13e3ad&#34;
</span></span></span><span class=line><span class=cl><span class=sh>            },
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_self&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateId&#34;: &#34;bc5a31ac-95b5-4ec6-be1f-50a384bb165f&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h3 class="relative group">Initial Rule End JSON<div id=initial-rule-end-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#initial-rule-end-json aria-label=Anchor>#</a></span></h3><p>The JSON contained below tails the first rule creation, with variables passed through based on the CSV report imported data for the following values:</p><ul><li>File Description</li><li>Rule Name</li><li>File Name</li><li>File Path</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleEnd</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_filedescription&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateId&#34;: &#34;5e10c5a9-d3ca-4684-b425-e52238cf3c8b&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class="line hl"><span class=cl><span class=sh>        &#34;value&#34;: &#34;</span><span class=nv>$FileDescription</span><span class=sh>&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateId&#34;: &#34;df3081ea-4ea7-4f34-ac87-49b2e84d4c4b&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;useTemplateDefault&#34;: false
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_name&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateId&#34;: &#34;fdabfcf9-afa4-4dbf-a4ef-d5c1549065e1&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;</span><span class=nv>$FileDescription</span><span class=sh> </span><span class=nv>$TypeDescription</span><span class=sh>&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateId&#34;: &#34;03f003e5-43ef-4e7e-bf30-57f00781fdcc&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;useTemplateDefault&#34;: false
</span></span></span><span class=line><span class=cl><span class=sh>            }
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_filename&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateId&#34;: &#34;0c1ceb2b-bbd4-46d4-9ba5-9ee7abe1f094&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;</span><span class=nv>$FileName</span><span class=sh>&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateId&#34;: &#34;a165327c-f0e5-4c7d-9af1-d856b02191f7&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;useTemplateDefault&#34;: false
</span></span></span><span class=line><span class=cl><span class=sh>            }
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_filepath&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateId&#34;: &#34;c3b7fda4-db6a-421d-bf04-d485e9d0cfb1&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;</span><span class=nv>$FilePath</span><span class=sh>&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateId&#34;: &#34;f011bcfc-03cd-4b28-a1f4-305278d7a030&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;useTemplateDefault&#34;: false
</span></span></span><span class=line><span class=cl><span class=sh>            }
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    }
</span></span></span><span class=line><span class=cl><span class=sh>]
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h2 class="relative group">Creating Subsequent Rules<div id=creating-subsequent-rules class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#creating-subsequent-rules aria-label=Anchor>#</a></span></h2><p>This is where I was on the strugglebus understanding what format the JSON needed to be in when a policy has multiple rules. Eventually I worked out that any additional rule added to the policy has different JSON formatting, with no need for the <code>settingValueTemplateId</code> values, so here we go.</p><h3 class="relative group">Rule Start JSON<div id=rule-start-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rule-start-json aria-label=Anchor>#</a></span></h3><p>The variables we created are added to the JSON in the same was as the initial rule, but with a differing JSON structure.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleStart</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>{
</span></span></span><span class=line><span class=cl><span class=sh>    &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>    &#34;children&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>        {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_appliesto&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;choiceSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_allusers&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;children&#34;: []
</span></span></span><span class=line><span class=cl><span class=sh>            }
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_description&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>                &#34;value&#34;: &#34;</span><span class=nv>$RuleDescription</span><span class=sh>&#34;
</span></span></span><span class=line><span class=cl><span class=sh>            }
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_productname&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>                &#34;value&#34;: &#34;</span><span class=nv>$FileProduct</span><span class=sh>&#34;
</span></span></span><span class=line><span class=cl><span class=sh>            }
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_internalname&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>                &#34;value&#34;: &#34;</span><span class=nv>$FileInternalName</span><span class=sh>&#34;
</span></span></span><span class=line><span class=cl><span class=sh>            }
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>        {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_filehash&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;</span><span class=nv>$FileHash</span><span class=sh>&#34;
</span></span></span><span class=line><span class=cl><span class=sh>            }
</span></span></span><span class=line><span class=cl><span class=sh>        },
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h3 class="relative group">Rule Elevation JSON<div id=rule-elevation-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rule-elevation-json aria-label=Anchor>#</a></span></h3><p>Based on the <code>$ElevationType</code> variable, we can define which of the below three elevation type JSON formats are passed into the policy JSON, but this time with different JSON structure.</p><h4 class="relative group">Rule Elevation Automatic<div id=rule-elevation-automatic class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rule-elevation-automatic aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleElev</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;choiceSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_automatic&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;children&#34;: []
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h4 class="relative group">Rule Elevation User Authentication<div id=rule-elevation-user-authentication class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rule-elevation-user-authentication aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleElev</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;choiceSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_self&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;children&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>                {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingCollectionInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype_validation&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;choiceSettingCollectionValue&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>                        {
</span></span></span><span class=line><span class=cl><span class=sh>                            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>                            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype_validation_1&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                            &#34;children&#34;: []
</span></span></span><span class=line><span class=cl><span class=sh>                        }
</span></span></span><span class=line><span class=cl><span class=sh>                    ]
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            ]
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h4 class="relative group">Rule Elevation User Business Justification<div id=rule-elevation-user-business-justification class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rule-elevation-user-business-justification aria-label=Anchor>#</a></span></h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleElev</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;choiceSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_self&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;children&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>                {
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationChoiceSettingCollectionInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype_validation&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>                    &#34;choiceSettingCollectionValue&#34;: [
</span></span></span><span class=line><span class=cl><span class=sh>                        {
</span></span></span><span class=line><span class=cl><span class=sh>                            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>                            &#34;value&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_ruletype_validation_0&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>                            &#34;children&#34;: []
</span></span></span><span class=line><span class=cl><span class=sh>                        }
</span></span></span><span class=line><span class=cl><span class=sh>                    ]
</span></span></span><span class=line><span class=cl><span class=sh>                }
</span></span></span><span class=line><span class=cl><span class=sh>            ]
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h3 class="relative group">Rule End JSON<div id=rule-end-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rule-end-json aria-label=Anchor>#</a></span></h3><p>The JSON below tails rule creation, with variables passed through based on the CSV report imported data, again with different JSON structure.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRuleEnd</span> <span class=p>=</span> <span class=sh>@&#34;
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_filedescription&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;</span><span class=nv>$FileDescription</span><span class=sh>&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_name&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;</span><span class=nv>$FileDescription</span><span class=sh> </span><span class=nv>$TypeDescription</span><span class=sh>&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_filename&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;</span><span class=nv>$FileName</span><span class=sh>&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>    {
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationSimpleSettingInstance&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingDefinitionId&#34;: &#34;device_vendor_msft_policy_privilegemanagement_elevationrules_{elevationrulename}_filepath&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;settingInstanceTemplateReference&#34;: null,
</span></span></span><span class=line><span class=cl><span class=sh>        &#34;simpleSettingValue&#34;: {
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;@odata.type&#34;: &#34;#microsoft.graph.deviceManagementConfigurationStringSettingValue&#34;,
</span></span></span><span class=line><span class=cl><span class=sh>            &#34;settingValueTemplateReference&#34;: null,
</span></span></span><span class="line hl"><span class=cl><span class=sh>            &#34;value&#34;: &#34;</span><span class=nv>$FilePath</span><span class=sh>&#34;
</span></span></span><span class=line><span class=cl><span class=sh>        }
</span></span></span><span class=line><span class=cl><span class=sh>    }
</span></span></span><span class=line><span class=cl><span class=sh>]
</span></span></span><span class=line><span class=cl><span class=sh>&#34;@</span>
</span></span></code></pre></div><h3 class="relative group">Rule Ending JSON<div id=rule-ending-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#rule-ending-json aria-label=Anchor>#</a></span></h3><p>By this point I&rsquo;m tired of looking at JSON, but we need to close off the rules before we complete the policy JSON as a whole; we have to identify whether the rule being processed is last rule, as the end of the JSON for rules will need to be different, in this case whether a <code>},</code> or a <code>}</code>, so we can use a quick query as to whether the rule being processed is the last in the array.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nv>$Rule</span> <span class=o>-eq</span> <span class=nv>$Rules</span><span class=p>[</span><span class=mf>-1</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$JSONRuleEnding</span> <span class=p>=</span> <span class=sh>@&#39;
</span></span></span><span class="line hl"><span class=cl><span class=sh>    }
</span></span></span><span class=line><span class=cl><span class=sh>&#39;@</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$JSONRuleEnding</span> <span class=p>=</span> <span class=sh>@&#39;
</span></span></span><span class="line hl"><span class=cl><span class=sh>    },
</span></span></span><span class=line><span class=cl><span class=sh>
</span></span></span><span class=line><span class=cl><span class=sh>&#39;@</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span></code></pre></div><h2 class="relative group">Submitting EPM Policies<div id=submitting-epm-policies class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#submitting-epm-policies aria-label=Anchor>#</a></span></h2><p>At this point we should have the all the JSON content we need, now is time to combine them all to form the master JSON which can be submitted to Graph API, but we need to firstly combine all the JSON variables, and secondly have a way to pass it to the API.</p><h3 class="relative group">Final Policy JSON<div id=final-policy-json class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#final-policy-json aria-label=Anchor>#</a></span></h3><p>Luckily we can define an array variable <code>$JSONRules</code> which we can add each combined rule to as we loop through each rule in the set.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONRule</span> <span class=p>=</span> <span class=nv>$JSONRuleStart</span> <span class=p>+</span> <span class=nv>$JSONRuleElev</span> <span class=p>+</span> <span class=nv>$JSONRuleEnd</span> <span class=p>+</span> <span class=nv>$JSONRuleEnding</span>
</span></span><span class=line><span class=cl><span class=nv>$JSONRules</span> <span class=p>+=</span> <span class=nv>$JSONRule</span>
</span></span></code></pre></div><p>Adding these combined rules to the <code>$JSONPolicyStart</code> and <code>$JSONPolicyEnd</code> variables will give us the required JSON file we can submit to Graph API.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$JSONOutput</span> <span class=p>=</span> <span class=nv>$JSONPolicyStart</span> <span class=p>+</span> <span class=nv>$JSONRules</span> <span class=p>+</span> <span class=nv>$JSONPolicyEnd</span>
</span></span></code></pre></div><h3 class="relative group">Pushing to Graph API<div id=pushing-to-graph-api class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#pushing-to-graph-api aria-label=Anchor>#</a></span></h3><p>JSON file complete, let&rsquo;s use a function to push the data to Microsoft Intune via Graph API, as I&rsquo;m not hand cranking this for every policy we want to create.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=kd>Function</span><span class=w> </span><span class=nb>New-DeviceSettingsCatalog</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>cmdletbinding</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>param</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Mandatory</span> <span class=p>=</span> <span class=vm>$true</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=nv>$JSON</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$graphApiVersion</span> <span class=p>=</span> <span class=s1>&#39;Beta&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Resource</span> <span class=p>=</span> <span class=s1>&#39;deviceManagement/configurationPolicies&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Test-Json</span> <span class=n>-Json</span> <span class=nv>$JSON</span>
</span></span><span class=line><span class=cl>        <span class=nv>$uri</span> <span class=p>=</span> <span class=s2>&#34;https://graph.microsoft.com/</span><span class=nv>$graphApiVersion</span><span class=s2>/</span><span class=p>$(</span><span class=nv>$Resource</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>Invoke-MgGraphRequest</span> <span class=n>-Uri</span> <span class=nv>$uri</span> <span class=n>-Method</span> <span class=n>Post</span> <span class=n>-Body</span> <span class=nv>$JSON</span> <span class=n>-ContentType</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Error</span> <span class=nv>$Error</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=py>ErrorDetails</span><span class=p>.</span><span class=py>Message</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We can now pass through the <code>$JSONOutput</code> variable to the above function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nv>$EPMPolicy</span> <span class=p>=</span> <span class=nb>New-DeviceSettingsCatalog</span> <span class=n>-JSON</span> <span class=nv>$JSONOutput</span>
</span></span></code></pre></div><p>With this we now have a method to push new policies, and if required, with multiple rules to Microsoft Intune.</p><h3 class="relative group">Assigning EPM Policies<div id=assigning-epm-policies class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#assigning-epm-policies aria-label=Anchor>#</a></span></h3><p>Now we have a way to create new EPM policies and rules, grouping the rules by the assignment group, it would only be right to square this all off by assigning the policy to the same group, outrageous I know. To do this we need another function using the <code>deviceManagement/configurationPolicies/$Id/assign</code> Graph API endpoint to create a new Settings Catalog policy assignment.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=kd>Function</span><span class=w> </span><span class=nb>Add-DeviceSettingsCatalogAssignment</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=nb>cmdletbinding</span><span class=p>()]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>param</span>
</span></span><span class=line><span class=cl>    <span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Mandatory</span> <span class=p>=</span> <span class=vm>$true</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>string</span><span class=p>]</span><span class=nv>$Id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Mandatory</span> <span class=p>=</span> <span class=vm>$false</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>string</span><span class=p>]</span><span class=nv>$Name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Mandatory</span> <span class=p>=</span> <span class=vm>$true</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>string</span><span class=p>]</span><span class=nv>$TargetGroupId</span><span class=p>,</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nb>parameter</span><span class=p>(</span><span class=na>Mandatory</span> <span class=p>=</span> <span class=vm>$true</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=nb>ValidateSet</span><span class=p>(</span><span class=s1>&#39;Include&#39;</span><span class=p>,</span> <span class=s1>&#39;Exclude&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=no>string</span><span class=p>]</span><span class=nv>$AssignmentType</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$graphApiVersion</span> <span class=p>=</span> <span class=s1>&#39;Beta&#39;</span>
</span></span><span class=line><span class=cl>    <span class=nv>$Resource</span> <span class=p>=</span> <span class=s2>&#34;deviceManagement/configurationPolicies/</span><span class=nv>$Id</span><span class=s2>/assign&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$TargetGroup</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=n>psobject</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$AssignmentType</span> <span class=o>-eq</span> <span class=s1>&#39;Exclude&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$TargetGroup</span> <span class=p>|</span> <span class=nb>Add-Member</span> <span class=n>-MemberType</span> <span class=n>NoteProperty</span> <span class=n>-Name</span> <span class=s1>&#39;@odata.type&#39;</span> <span class=n>-Value</span> <span class=s1>&#39;#microsoft.graph.exclusionGroupAssignmentTarget&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>elseif</span> <span class=p>(</span><span class=nv>$AssignmentType</span> <span class=o>-eq</span> <span class=s1>&#39;Include&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$TargetGroup</span> <span class=p>|</span> <span class=nb>Add-Member</span> <span class=n>-MemberType</span> <span class=n>NoteProperty</span> <span class=n>-Name</span> <span class=s1>&#39;@odata.type&#39;</span> <span class=n>-Value</span> <span class=s1>&#39;#microsoft.graph.groupAssignmentTarget&#39;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$TargetGroup</span> <span class=p>|</span> <span class=nb>Add-Member</span> <span class=n>-MemberType</span> <span class=n>NoteProperty</span> <span class=n>-Name</span> <span class=s1>&#39;groupId&#39;</span> <span class=n>-Value</span> <span class=s2>&#34;</span><span class=nv>$TargetGroupId</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nv>$Target</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=n>psobject</span>
</span></span><span class=line><span class=cl>        <span class=nv>$Target</span> <span class=p>|</span> <span class=nb>Add-Member</span> <span class=n>-MemberType</span> <span class=n>NoteProperty</span> <span class=n>-Name</span> <span class=s1>&#39;target&#39;</span> <span class=n>-Value</span> <span class=nv>$TargetGroup</span>
</span></span><span class=line><span class=cl>        <span class=nv>$TargetGroups</span> <span class=p>=</span> <span class=nv>$Target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># Creating JSON object to pass to Graph</span>
</span></span><span class=line><span class=cl>        <span class=nv>$Output</span> <span class=p>=</span> <span class=nb>New-Object</span> <span class=n>-TypeName</span> <span class=n>psobject</span>
</span></span><span class=line><span class=cl>        <span class=nv>$Output</span> <span class=p>|</span> <span class=nb>Add-Member</span> <span class=n>-MemberType</span> <span class=n>NoteProperty</span> <span class=n>-Name</span> <span class=s1>&#39;assignments&#39;</span> <span class=n>-Value</span> <span class=vm>@</span><span class=p>(</span><span class=nv>$TargetGroups</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nv>$JSON</span> <span class=p>=</span> <span class=nv>$Output</span> <span class=p>|</span> <span class=nb>ConvertTo-Json</span> <span class=n>-Depth</span> <span class=mf>3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c># POST to Graph Service</span>
</span></span><span class=line><span class=cl>        <span class=nv>$uri</span> <span class=p>=</span> <span class=s2>&#34;https://graph.microsoft.com/</span><span class=nv>$graphApiVersion</span><span class=s2>/</span><span class=p>$(</span><span class=nv>$Resource</span><span class=p>)</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>Invoke-MgGraphRequest</span> <span class=n>-Uri</span> <span class=nv>$uri</span> <span class=n>-Method</span> <span class=n>Post</span> <span class=n>-Body</span> <span class=nv>$JSON</span> <span class=n>-ContentType</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Host</span> <span class=s2>&#34;Successfully assigned policy </span><span class=nv>$Name</span><span class=s2>&#34;</span> <span class=n>-ForegroundColor</span> <span class=n>Green</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>catch</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nb>Write-Error</span> <span class=nv>$Error</span><span class=p>[</span><span class=mf>0</span><span class=p>].</span><span class=py>ErrorDetails</span><span class=p>.</span><span class=py>Message</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We can finally assign the policy passing through the required information from the <code>$EPMPolicy</code> variable that contains the details of the newly created EPM policy.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=nb>Add-DeviceSettingsCatalogAssignment</span> <span class=n>-id</span> <span class=nv>$EPMPolicy</span><span class=p>.</span><span class=py>id</span> <span class=n>-TargetGroupId</span> <span class=nv>$Group</span><span class=p>.</span><span class=py>id</span> <span class=n>-AssignmentType</span> <span class=n>Include</span>
</span></span></code></pre></div><p>If you&rsquo;re still with me, and you probably are as I haven&rsquo;t posted the full script yet, congratulations, we&rsquo;re almost there.</p><h2 class="relative group">EPM Policy Deployment<div id=epm-policy-deployment class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#epm-policy-deployment aria-label=Anchor>#</a></span></h2><p>We&rsquo;re here, finally, with a complete <a href=https://github.com/ennnbeee/mve-scripts/blob/main/Intune/EndpointSecurity/EPMAutomation/Invoke-MgEPNRules.ps1 target=_blank>PowerShell Script</a> ready to be used and abused. Let&rsquo;s look at the options we have when running the script.</p><h3 class="relative group">Report Mode<div id=report-mode class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#report-mode aria-label=Anchor>#</a></span></h3><p>Running the script with the below parameters we can export the existing Unmanaged elevations to a location of our choosing that you will be prompted for after running the script.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=p>./</span><span class=nb>Invoke-EPNRules</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-tenantID</span> <span class=s1>&#39;bb690aa6-53c6-4d51-affe-ab80c6d710de&#39;</span> <span class=n>-Deployment</span> <span class=n>Report</span>
</span></span></code></pre></div><p>This CSV file can then updated with the elevation types and groups the rules can be assigned to, as per the example below.</p><pre tabindex=0><code class=language-CSV data-lang=CSV>&#34;ElevationCount&#34;,&#34;Product&#34;,&#34;Description&#34;,&#34;Publisher&#34;,&#34;FileName&#34;,&#34;FilePath&#34;,&#34;FileHash&#34;,&#34;Users&#34;,&#34;Devices&#34;,&#34;ElevationType&#34;,&#34;Group&#34;
&#34;6&#34;,&#34;Microsoft® Windows® Operating System&#34;,&#34;Windows PowerShell&#34;,&#34;Microsoft Corporation&#34;,&#34;powershell.exe&#34;,&#34;C:\\Windows\\System32\\WindowsPowerShell\\v1.0&#34;,&#34;B4E7BC24BF3F5C3DA2EB6E9EC5EC10F90099DEFA91B820F2F3FC70DD9E4785C4&#34;,&#34;AzureAD\AlexWilber AzureAD\ChristieCline&#34;,&#34;DESKTOP-DL6CCRJ DESKTOP-7KFLL12&#34;,&#34;UserJustification&#34;,&#34;sg-IT&#34;
&#34;4&#34;,&#34;PaladinVPN&#34;,&#34;PaladinVPN&#34;,&#34;Ledger Media Ltd&#34;,&#34;PaladinVPN.exe&#34;,&#34;C:\\Program Files (x86)\\PaladinVPN&#34;,&#34;B6EF395DE2F28162DBAFCA79BAABEBB211245A68425CE096402030417FEA1160&#34;,&#34;AzureAD\AlexWilber&#34;,&#34;DESKTOP-DL6CCRJ&#34;,&#34;Automatic&#34;,&#34;sg-Operations&#34;
&#34;12&#34;,&#34;Microsoft® Windows® Operating System&#34;,&#34;Windows Command Processor&#34;,&#34;Microsoft Corporation&#34;,&#34;cmd.exe&#34;,&#34;C:\\Windows\\system32&#34;,&#34;B99D61D874728EDC0918CA0EB10EAB93D381E7367E377406E65963366C874450&#34;,&#34;AzureAD\AlexWilber AzureAD\ChristieCline&#34;,&#34;DESKTOP-DL6CCRJ DESKTOP-7KFLL12&#34;,&#34;UserAuthentication&#34;,&#34;sg-IT&#34;
</code></pre><h3 class="relative group">Create Mode<div id=create-mode class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#create-mode aria-label=Anchor>#</a></span></h3><p>The CSV file can then be used for the creation of rules using the below command (you will be prompted for the path to the CSV file).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=p>./</span><span class=nb>Invoke-EPNRules</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-tenantID</span> <span class=s1>&#39;bb690aa6-53c6-4d51-affe-ab80c6d710de&#39;</span> <span class=n>-Deployment</span> <span class=n>Import</span>
</span></span></code></pre></div><p>Which will result in the EPM policies being created:</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/img/epm-pols_hu823aa96819759cd35a49afb2080dbee7_16450_filter_6893521939510010427.webp#left alt="Elevation Policies"><figcaption>Screenshot of Microsoft Intune Elevation Policy.</figcaption></figure></p><p>Drilling into the EPM policy we can see the rules that were created:</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/img/epm-rules_hu73271e8496dc4e241261601aed02f51f_58928_filter_12139771149114251270.webp#left alt="Elevation Rules"><figcaption>Screenshot of Microsoft Intune Elevation Rules.</figcaption></figure></p><p>Digging a little further we can see the settings for the rules:</p><ul><li>PowerShell User Approved with Business Justification</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy src=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/img/epm-rulepwsh_huad4de89639fff849b478024f49c23221_37296_filter_15851788210772834802.webp#left alt="Elevation PowerShell Rule"><figcaption>Screenshot of Microsoft Intune Elevation Rules Detail for Business Justification.</figcaption></figure></p><ul><li>Command Prompt User Approved with Authentication</li></ul><p><figure><img class="my-0 rounded-md" loading=lazy src=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/img/epm-rulecmd_hu430e258364613958880f8616d0b599f6_35716_filter_15851788210772834802.webp#left alt="Elevation CMD Rule"><figcaption>Screenshot of Microsoft Intune Elevation Rules Detail for Authentication.</figcaption></figure></p><h3 class="relative group">Create and Assign Mode<div id=create-and-assign-mode class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#create-and-assign-mode aria-label=Anchor>#</a></span></h3><p>Or if you want to be <del>reckless</del> bold and create <em>and</em> assign the policies, use the below (you will be prompted for the path to the CSV file).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-PowerShell data-lang=PowerShell><span class=line><span class=cl><span class=p>./</span><span class=nb>Invoke-EPNRules</span><span class=p>.</span><span class=py>ps1</span> <span class=n>-tenantID</span> <span class=s1>&#39;bb690aa6-53c6-4d51-affe-ab80c6d710de&#39;</span> <span class=n>-Deployment</span> <span class=n>ImportAssign</span>
</span></span></code></pre></div><p>Which will give us the above policies created, but also assigned to the relevant groups:</p><p><figure><img class="my-0 rounded-md" loading=lazy src=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/img/epm-ruleass_huf2211f046746fb2333dfc9cb2bd0ed01_17080_filter_8431587094164680350.webp#left alt="Elevation Rule Assignment"><figcaption>Screenshot of Microsoft Intune Elevation Rules assignment.</figcaption></figure></p><h2 class="relative group">Summary<div id=summary class=anchor></div><span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style=text-decoration-line:none!important href=#summary aria-label=Anchor>#</a></span></h2><p>This script doesn&rsquo;t take into consideration the members of the groups as part of the assignment, and subsequently any <a href=https://learn.microsoft.com/en-us/mem/intune/protect/epm-policies#policy-conflict-handling-for-endpoint-privilege-management target=_blank>conflict</a> or crossover of rules on a per user or device basis, but then I can&rsquo;t script every step of logic as part of an Endpoint Privilege Management implementation, you still have to use your brain somewhere along the way.</p><p>What it does give you is an ability to readily identify the priority of elevations required by your user base, a way to review the applications actively being elevated, and importantly a way to use this data and information to automatically create Endpoint Privilege Management policies and rules without the risk of human error when creating rules manually.</p></div><section class="flex flex-row flex-wrap justify-center pt-4 text-xl"><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/&amp;title=Automating%20Endpoint%20Privilege%20Management%20Policies%20with%20PowerShell" title="Share on LinkedIn" aria-label="Share on LinkedIn"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://twitter.com/intent/tweet/?url=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/&amp;text=Automating%20Endpoint%20Privilege%20Management%20Policies%20with%20PowerShell" title="Tweet on Twitter" aria-label="Tweet on Twitter"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://reddit.com/submit/?url=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/&amp;resubmit=true&amp;title=Automating%20Endpoint%20Privilege%20Management%20Policies%20with%20PowerShell" title="Submit to Reddit" aria-label="Submit to Reddit"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M201.5 305.5c-13.8.0-24.9-11.1-24.9-24.6.0-13.8 11.1-24.9 24.9-24.9 13.6.0 24.6 11.1 24.6 24.9.0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4.0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7.0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9.0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5.0 52.6 59.2 95.2 132 95.2 73.1.0 132.3-42.6 132.3-95.2.0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6.0-2.2-2.2-6.1-2.2-8.3.0-2.5 2.5-2.5 6.4.0 8.6 22.8 22.8 87.3 22.8 110.2.0 2.5-2.2 2.5-6.1.0-8.6-2.2-2.2-6.1-2.2-8.3.0zm7.7-75c-13.6.0-24.6 11.1-24.6 24.9.0 13.6 11.1 24.6 24.6 24.6 13.8.0 24.9-11.1 24.9-24.6.0-13.8-11-24.9-24.9-24.9z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://api.whatsapp.com/send?text=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/&amp;resubmit=true&amp;title=Automating%20Endpoint%20Privilege%20Management%20Policies%20with%20PowerShell" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4.0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3.0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2.0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2.0-101.7 82.8-184.5 184.6-184.5 49.3.0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5.0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3.0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://t.me/share/url?url=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/&amp;resubmit=true&amp;title=Automating%20Endpoint%20Privilege%20Management%20Policies%20with%20PowerShell" title aria-label><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M248 8C111.033 8 0 119.033.0 256S111.033 504 248 504 496 392.967 496 256 384.967 8 248 8zM362.952 176.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.452 10.452.0 013.53 6.716A43.765 43.765.0 01362.952 176.66z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://pinterest.com/pin/create/bookmarklet/?url=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/&amp;description=Automating%20Endpoint%20Privilege%20Management%20Policies%20with%20PowerShell" title="Pin on Pinterest" aria-label="Pin on Pinterest"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M496 256c0 137-111 248-248 248-25.6.0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8.0 128.7-68.8 128.7-154.3.0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1.0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6.0-54.7 41.4-107.6 112-107.6 60.9.0 103.6 41.5 103.6 100.9.0 67.1-33.9 113.6-78 113.6-24.3.0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6.0-19-10.2-34.9-31.4-34.9-24.9.0-44.9 25.7-44.9 60.2.0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9.0 361.1.0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="https://www.facebook.com/sharer/sharer.php?u=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/&amp;quote=Automating%20Endpoint%20Privilege%20Management%20Policies%20with%20PowerShell" title="Share on Facebook" aria-label="Share on Facebook"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14.0 55.52 4.84 55.52 4.84v61h-31.28c-30.8.0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
</span></a><a target=_blank class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800" href="mailto:?body=https://memv.ennbee.uk/posts/automate-endpoint-privilege-management/&amp;subject=Automating%20Endpoint%20Privilege%20Management%20Policies%20with%20PowerShell" title="Send via email" aria-label="Send via email"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1-27.64 140.9 68.65 266.2 199.1 285.1 19.01 2.888 36.17-12.26 36.17-31.49l1e-4-.6631c0-15.74-11.44-28.88-26.84-31.24-84.35-12.98-149.2-86.13-149.2-174.2.0-102.9 88.61-185.5 193.4-175.4 91.54 8.869 158.6 91.25 158.6 183.2v16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98.0036c-7.299.0-13.2 4.992-15.12 11.68-24.85-12.15-54.24-16.38-86.06-5.106-38.75 13.73-68.12 48.91-73.72 89.64-9.483 69.01 43.81 128 110.9 128 26.44.0 50.43-9.544 69.59-24.88 24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3c0-149.2-133.9-265.632-287.3-235.57zM239.1 304.3c-26.47.0-48-21.56-48-48.05s21.53-48.05 48-48.05 48 21.56 48 48.05-20.6 48.05-48 48.05z"/></svg></span></a></section><h2 class="mt-8 text-2xl font-extrabold mb-10">Related</h2><section class="w-full grid gap-4 sm:grid-cols-2 md:grid-cols-3"><a href=/posts/defender-antivirus-compliance-updates/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/posts/defender-antivirus-compliance-updates/featured.png)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/defender-antivirus-compliance-updates/>Updating Defender Antivirus Compliance Settings</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-10-25 22:04:47 +0100 +0100">25 October 2022</time><span class="px-2 text-primary-500">&#183;</span><span>
<span id=views_posts/Defender-Antivirus-Compliance-Updates/index.md class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400" title=views>loading</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/intune/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Microsoft Intune
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/windows/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Windows 10 and later
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/defender/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Microsoft Defender
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/security/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Security
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/compliance/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Compliance
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/updates/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Updates
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/antivirus/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Antivirus
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/graph/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Graph API
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/powershell/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">PowerShell</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/posts/operating-system-compliance-updates/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/posts/operating-system-compliance-updates/featured.png)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/operating-system-compliance-updates/>Windows Operating System Compliance Updates</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-06-30 11:20:36 +0100 +0100">30 June 2022</time><span class="px-2 text-primary-500">&#183;</span><span>
<span id=views_posts/Operating-System-Compliance-Updates/index.md class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400" title=views>loading</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/intune/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Microsoft Intune
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/windows/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Windows 10 and later
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/compliance/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Compliance
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/updates/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Updates
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/security/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Security
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/graph/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Graph API
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/powershell/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">PowerShell</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a><a href=/posts/windows-autopilot-retrofitting-group-tags/ class=min-w-full><div class="min-h-full border border-neutral-200 dark:border-neutral-700 border-2 rounded overflow-hidden shadow-2xl relative"><div class="w-full thumbnail_card_related nozoom" style=background-image:url(/posts/windows-autopilot-retrofitting-group-tags/featured.png)></div><div class="px-6 py-4"><div class="font-bold text-xl text-neutral-800 decoration-primary-500 hover:underline hover:underline-offset-2 dark:text-neutral" href=/posts/windows-autopilot-retrofitting-group-tags/>Retrofitting Windows Autopilot Group Tags</div><div class="text-sm text-neutral-500 dark:text-neutral-400"><div class="flex flex-row flex-wrap items-center"><time datetime="2022-06-19 15:55:02 +0100 +0100">19 June 2022</time><span class="px-2 text-primary-500">&#183;</span><span>
<span id=views_posts/Windows-Autopilot-Retrofitting-Group-Tags/index.md class="animate-pulse inline-block text-transparent max-h-3 rounded-full mt-[-2px] align-middle bg-neutral-300 dark:bg-neutral-400" title=views>loading</span>
<span class="inline-block align-text-bottom"><span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentcolor" d="M288 32c-80.8.0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7.0 24.6C17.3 304 48.6 356 95.4 399.4 142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1 3.3-7.9 3.3-16.7.0-24.6-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144 64.5-144 144-144 144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64-11.5.0-22.3-3-31.6-8.4-.2 2.8-.4 5.5-.4 8.4.0 53 43 96 96 96s96-43 96-96-43-96-96-96c-2.8.0-5.6.1-8.4.4 5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></span></span></div><div class="flex flex-row flex-wrap items-center"><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/intune/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Microsoft Intune
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/categories/windows/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Windows 10 and later
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/autopilot/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Windows Autopilot
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/enrolment/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Enrolment
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/graph/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">Graph API
</span></span></span><span style=margin-top:.5rem class=mr-2 onclick='window.open("/tags/powershell/","_self")'><span class=flex style=cursor:pointer><span class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400">PowerShell</span></span></span></div></div></div><div class="px-6 pt-4 pb-2"></div></div></a></section></div><script>var oid="views_posts/Automate-Endpoint-Privilege-Management/index.md",oid_likes="likes_posts/Automate-Endpoint-Privilege-Management/index.md"</script><script type=text/javascript src=/js/page.min.0860cf4e04fa2d72cc33ddba263083464d48f67de06114529043cb4623319efed4f484fd7f1730df5abea0e2da6f3538855634081d02f2d6e920b956f063e823.js integrity="sha512-CGDPTgT6LXLMM926JjCDRk1I9n3gYRRSkEPLRiMxnv7U9IT9fxcw31q+oOLabzU4hVY0CB0C8tbpILlW8GPoIw=="></script></section><footer class="pt-8 max-w-prose print:hidden"><div class=pt-8><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class="flex justify-between pt-3"><span><a class="flex group mr-3" href=/posts/custom-compliance-third-party-av/><span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&larr;</span>
<span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Detailed Compliance for Non-Microsoft Antivirus Solutions</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-06-11 21:25:23 +0100 +0100">11 June 2023</time>
</span></span></a></span><span><a class="flex text-right group ml-3" href=/posts/macos-teams-backgrounds/><span class="flex flex-col"><span class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500">Deploying Teams Backgrounds to macOS Devices</span>
<span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400"><time datetime="2023-03-14 20:39:58 +0000 UTC">14 March 2023</time>
</span></span><span class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400">&rarr;</span>
<span class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400">&larr;</span></a></span></div></div><div class=pt-3><hr class="border-dotted border-neutral-300 dark:border-neutral-600"><div class=pt-3><script src=https://giscus.app/client.js data-repo=ennnbeee/ennnbeee.github.io data-repo-id=R_kgDOLUU7Lg data-category=Comments data-category-id=DIC_kwDOLUU7Ls4CdUYI data-mapping=title data-strict=0 data-reactions-enabled=0 data-emit-metadata=0 data-input-position=top data-theme=https://memv.ennbee.uk/css/giscus.css data-lang=en data-loading=" lazy" crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the comments powered by giscus.</noscript></div></div></footer></article><div id=top-scroller class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0"><a href=#the-top class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400" aria-label="Scroll to top" title="Scroll to top">&uarr;</a></div></main><footer id=site-footer class="py-10 print:hidden"><nav class="flex flex-row pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400"><ul class="flex flex-col list-none sm:flex-row"><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/tags/ title>Tags</a></li><li class="flex mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"><a class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2 flex items-center" href=/categories/ title>Categories</a></li></ul></nav><div class="flex items-center justify-between"><p class="text-sm text-neutral-500 dark:text-neutral-400">© 2024 Nick Benton, MEM v ENNBEE</p><p class="text-xs text-neutral-500 dark:text-neutral-400">Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://gohugo.io/ target=_blank rel="noopener noreferrer">Hugo</a> & <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href=https://blowfish.page/ target=_blank rel="noopener noreferrer">Blowfish</a></p></div><script>mediumZoom(document.querySelectorAll("img:not(.nozoom)"),{margin:24,background:"rgba(0,0,0,0.5)",scrollOffset:0})</script><script type=text/javascript src=/js/process.min.ee03488f19c93c2efb199e2e3014ea5f3cb2ce7d45154adb3399a158cac27ca52831db249ede5bb602700ef87eb02434139de0858af1818ab0fb4182472204a4.js integrity="sha512-7gNIjxnJPC77GZ4uMBTqXzyyzn1FFUrbM5mhWMrCfKUoMdsknt5btgJwDvh+sCQ0E53ghYrxgYqw+0GCRyIEpA=="></script></footer><div id=search-wrapper class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]" data-url=https://memv.ennbee.uk/ style=z-index:500><div id=search-modal class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"><header class="relative z-10 flex items-center justify-between flex-none px-2"><form class="flex items-center flex-auto min-w-0"><div class="flex items-center justify-center w-8 h-8 text-neutral-400"><span class="relative block icon"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentcolor" d="M505 442.7 405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9.0 208 0S0 93.1.0 208s93.1 208 208 208c48.3.0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9.0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7.0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7.0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg></span></div><input type=search id=search-query class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent" placeholder=Search tabindex=0></form><button id=close-search-button class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400" title="Close (Esc)">
<span class="relative block icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentcolor" d="M310.6 361.4c12.5 12.5 12.5 32.75.0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3 54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75.0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75.0-45.25s32.75-12.5 45.25.0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25.0s12.5 32.75.0 45.25l-105.4 105.4L310.6 361.4z"/></svg></span></button></header><section class="flex-auto px-2 overflow-auto"><ul id=search-results></ul></section></div></div></div></body></html>